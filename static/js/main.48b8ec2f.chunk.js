(this["webpackJsonpdalgona-meme"]=this["webpackJsonpdalgona-meme"]||[]).push([[0],{202:function(e,t,n){},203:function(e,t,n){},216:function(e,t){},218:function(e,t){},228:function(e,t){},230:function(e,t){},255:function(e,t){},256:function(e,t){},261:function(e,t){},263:function(e,t){},270:function(e,t){},289:function(e,t){},305:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(31),c=n.n(i),s=(n(202),n(11)),o=(n(203),n(356)),l=n(357),u=n(26),d=n.n(u),h=n(44),j=n(40),b=n(33),g=n(364),f=n(181),x=n.n(f),p=n(350),m=n(358),v=n(354),O=n(359),y=n(360),w=n(352),k=n(353),I=n(51),C=Object(I.b)({name:"dalgona-state",initialState:{scale:1,isLoading:!1,generate:!1},reducers:{changeDalgonaState:function(e,t){return t.payload}}}),S=C.actions.changeDalgonaState,L=C.reducer,R=n(361),D=n(362),T=n(183),F=n.n(T),B=n(182),E=n.n(B),P=n(363),U=function(e){var t=e.action,n=e.category,a=e.label,r=e.value;window.gtag("event",t,{event_category:n,event_label:a,value:r})},z=n(1),G=function(e){var t,n=e.onClickGenerate,a=r.a.useState(),i=Object(s.a)(a,2),c=i[0],l=i[1],u=r.a.useState(1),f=Object(s.a)(u,2),I=f[0],C=f[1],L=r.a.useState(""),T=Object(s.a)(L,2),B=T[0],G=T[1],A=r.a.useState(""),M=Object(s.a)(A,2),Y=M[0],_=M[1],X=Object(b.c)((function(e){return e.dalgonaState})),J=Object(b.b)();r.a.useEffect((function(){if("number"===typeof I){var e=Object(j.a)({},X);e.scale=I,J(S(e))}}),[I]),r.a.useEffect((function(){var e,t;X.threshold1!==B&&G(null!==(e=null===X||void 0===X||null===(t=X.threshold1)||void 0===t?void 0:t.toFixed(2))&&void 0!==e?e:"")}),[X.threshold1]),r.a.useEffect((function(){var e,t;X.threshold2!==Y&&_(null!==(e=null===X||void 0===X||null===(t=X.threshold2)||void 0===t?void 0:t.toFixed(2))&&void 0!==e?e:"")}),[X.threshold2]),r.a.useEffect((function(){console.log("dalgonaState.isLoading: ".concat(X.isLoading))}),[X.isLoading]);var W=function(){var e=Object(h.a)(d.a.mark((function e(){var t,a,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==c){e.next=3;break}return alert("\uc0ac\uc6a9\ud560 \uc774\ubbf8\uc9c0\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694."),e.abrupt("return");case 3:return t=Date.now(),e.next=6,c.arrayBuffer();case 6:a=e.sent,n(a),r=Date.now()-t,U({action:"generate",category:"click",label:JSON.stringify({elapsed:r}),value:0});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(e){return function(t,n){"number"===typeof n?e(n):console.error("invalid type of newValue (type: ".concat(typeof n,")"))}},V=function(e){return function(t){e(""===t.target.value?"":Number(t.target.value))}},q=function(e){G(e);var t=Object(j.a)({},X);t.threshold1="number"===typeof e?e:void 0,J(S(t))},H=function(e){_(e);var t=Object(j.a)({},X);t.threshold2="number"===typeof e?e:void 0,J(S(t))};return Object(z.jsxs)("form",{children:[Object(z.jsx)("input",{type:"file",id:"input-photo",accept:"image/*",onChange:function(e){if(console.log(e.target.value),console.log(e.currentTarget.files),e.currentTarget.files&&e.currentTarget.files.length>0){var t=e.currentTarget.files[0];l(t)}},disabled:X.isLoading}),Object(z.jsx)(p.a,{title:"Select image",children:Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)("label",{htmlFor:"input-photo",children:Object(z.jsx)(m.a,{color:"primary","aria-label":"upload picture",component:"span",disabled:X.isLoading,children:Object(z.jsx)(x.a,{fontSize:"large"})})}),Object(z.jsx)(O.a,{children:Object(z.jsxs)(o.a,{container:!0,spacing:2,alignItems:"center",children:[Object(z.jsx)(o.a,{item:!0,xs:6,children:Object(z.jsx)(y.a,{id:"lt-slider",gutterBottom:!0,children:"Threshold 1"})}),Object(z.jsx)(o.a,{item:!0,xs:6,children:Object(z.jsx)(R.a,{children:Object(z.jsx)(D.a,{control:Object(z.jsx)(k.a,{disabled:X.isLoading,checked:void 0===X.threshold1,onChange:function(e){var t=e.target.checked;q(t?"":.01)}}),label:"auto"})})})]})}),Object(z.jsx)(O.a,{children:Object(z.jsxs)(o.a,{container:!0,spacing:2,alignItems:"center",children:[Object(z.jsx)(o.a,{item:!0,xs:10,children:Object(z.jsx)(v.a,{track:!1,"aria-labelledby":"lt-slider",valueLabelDisplay:"auto",value:void 0===X.threshold1?0:X.threshold1,onChange:N(q),step:1,min:0,max:255,disabled:X.isLoading})}),Object(z.jsx)(o.a,{item:!0,xs:!0,children:Object(z.jsx)(w.a,{value:B,size:"small",inputProps:{min:0,max:255,step:1,type:"number","aria-labelledby":"threshold1-slider"},onChange:V(q),disabled:X.isLoading})})]})}),Object(z.jsx)(O.a,{children:Object(z.jsxs)(o.a,{container:!0,spacing:2,alignItems:"center",children:[Object(z.jsx)(o.a,{item:!0,xs:6,children:Object(z.jsx)(y.a,{id:"ut-slider",gutterBottom:!0,children:"Threshold 2"})}),Object(z.jsx)(o.a,{item:!0,xs:6,children:Object(z.jsx)(R.a,{children:Object(z.jsx)(D.a,{control:Object(z.jsx)(k.a,{disabled:X.isLoading,checked:void 0===X.threshold2,onChange:function(e){var t=e.target.checked;H(t?"":.5)}}),label:"auto"})})})]})}),Object(z.jsx)(O.a,{children:Object(z.jsxs)(o.a,{container:!0,spacing:2,alignItems:"center",children:[Object(z.jsx)(o.a,{item:!0,xs:10,children:Object(z.jsx)(v.a,{track:!1,"aria-labelledby":"ut-slider",valueLabelDisplay:"auto",value:null!==(t=null===X||void 0===X?void 0:X.threshold2)&&void 0!==t?t:0,onChange:N(H),step:1,min:0,max:255,disabled:X.isLoading})}),Object(z.jsx)(o.a,{item:!0,xs:!0,children:Object(z.jsx)(w.a,{value:Y,size:"small",inputProps:{min:0,max:255,step:1,type:"number","aria-labelledby":"threshold2-slider"},onChange:V(H),disabled:X.isLoading})})]})}),Object(z.jsxs)(O.a,{children:[Object(z.jsx)(y.a,{id:"scale-slider",gutterBottom:!0,children:"Image scale"}),Object(z.jsxs)(o.a,{container:!0,spacing:2,alignItems:"center",children:[Object(z.jsx)(o.a,{item:!0,xs:10,children:Object(z.jsx)(v.a,{track:!1,"aria-labelledby":"scale-slider",valueLabelDisplay:"auto",value:"number"===typeof I?I:1,onChange:N(C),step:.1,min:.1,max:2,disabled:X.isLoading})}),Object(z.jsx)(o.a,{item:!0,xs:!0,children:Object(z.jsx)(w.a,{value:I,size:"small",inputProps:{min:.1,max:2,step:.1,type:"number","aria-labelledby":"scale-slider"},onChange:V(C),disabled:X.isLoading})})]})]}),Object(z.jsx)(O.a,{style:{marginTop:"18px"},children:Object(z.jsx)(o.a,{container:!0,spacing:2,alignItems:"center",children:X.isLoading?Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(o.a,{item:!0,xs:5}),Object(z.jsx)(o.a,{item:!0,xs:2,children:Object(z.jsx)(P.a,{})}),Object(z.jsx)(o.a,{item:!0,xs:5})]}):Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(o.a,{item:!0,xs:6,children:Object(z.jsx)(g.a,{variant:"outlined",onClick:W,startIcon:Object(z.jsx)(E.a,{}),children:"Apply"})}),Object(z.jsx)(o.a,{item:!0,xs:6,children:Object(z.jsx)(g.a,{variant:"outlined",onClick:function(){var e=Object(j.a)({},X);e.generate=!0,J(S(e)),U({action:"download",category:"click",label:"",value:0})},startIcon:Object(z.jsx)(F.a,{}),children:"Generate"})})]})})})]})})]})},A=n(46),M=n.n(A),Y=n.p+"static/media/background.d52b6394.png",_=n.p+"static/media/mask.5c3c32d3.png",X=Object(I.b)({name:"result-image-state",initialState:{dataUrl:void 0},reducers:{changeResultImageState:function(e,t){return t.payload}}}),J=X.actions.changeResultImageState,W=X.reducer,N=function(e){return"data:image/png;base64,".concat(function(e){var t=new Uint8Array(e);return btoa(t.reduce((function(e,t){return e+String.fromCharCode(t)}),""))}(e))},V=function(e){var t=e.imgBuf,n=1543,a=770,i=82,c=48,o=12,l=r.a.useRef(null),u=r.a.useRef(null),g=r.a.useRef(null),f=r.a.useRef(null),x=r.a.useRef(null),p=r.a.useRef(null),m=r.a.useRef(null),v=r.a.useState(!1),O=Object(s.a)(v,2),y=O[0],w=O[1],k=r.a.useState({x:0,y:0}),I=Object(s.a)(k,2),C=I[0],L=I[1],R=r.a.useState({x:818,y:376}),D=Object(s.a)(R,2),T=D[0],F=D[1],B=Object(b.c)((function(e){return e.dalgonaState})),E=Object(b.b)();r.a.useEffect((function(){B.generate&&A()}),[B.generate]),r.a.useEffect((function(){G(T.x,T.y).then()}),[B.scale]);var P=function(){var e=Object(h.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=new Image;a.src=t,a.crossOrigin="Anonymous",a.onload=function(){console.timeEnd("loadImage"),e(a)}})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=Object(h.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof l){e.next=3;break}return console.time("canvasBackgroundRef is undefined"),e.abrupt("return");case 3:if(null!==(t=l.current)){e.next=7;break}return console.log("canvasBackgroundRef.current is null"),e.abrupt("return");case 7:if(null!==(n=t.getContext("2d"))){e.next=10;break}return e.abrupt("return");case 10:return e.t0=n,e.next=13,P(Y);case 13:e.t1=e.sent,e.t0.drawImage.call(e.t0,e.t1,0,0),n.save();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),G=function(){var e=Object(h.a)(d.a.mark((function e(t,n){var a,r,i,c,s,o,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof u&&null!==u){e.next=3;break}return console.time("canvasPictureRef is undefined or null"),e.abrupt("return");case 3:if(null!==x){e.next=6;break}return console.time("imageRef is null"),e.abrupt("return");case 6:if(null!==(a=u.current)){e.next=10;break}return console.log("canvasPictureRef.current is null"),e.abrupt("return");case 10:if(null!==(r=a.getContext("2d"))){e.next=13;break}return e.abrupt("return");case 13:r.clearRect(0,0,a.width,a.height),r.beginPath(),r.drawImage(p.current,0,0),r.save(),r.translate(771.5,385),r.globalCompositeOperation="source-in",i=(-771.5+t)*B.scale,c=(-385+n)*B.scale,console.log("posX: ".concat(i,", posY: ").concat(c)),s=m.current,o=parseInt(s.width+"")*B.scale,l=parseInt(s.height+"")*B.scale,r.drawImage(s,i,c,o,l),r.restore();case 27:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),A=function(){var e=l.current,t=u.current,n=f.current,a=n.getContext("2d");a.drawImage(e,0,0),a.drawImage(t,0,0);var r={dataUrl:n.toDataURL()};E(J(r));var i=Object(j.a)({},B);i.generate=!1,E(S(i))};r.a.useEffect((function(){U().then()}),[l]),r.a.useEffect((function(){if(void 0!==t&&null!==x&&null!==p){X(!0),E(J({dataUrl:void 0}));var e=p.current;e.onload=function(){var e=x.current;e.onload=function(){if(void 0!==t){var n=g.current,a=n.getContext("2d");a.clearRect(0,0,e.width,e.height),n.height=e.height,n.width=e.width,console.log("width: ".concat(n.width)),console.log("height: ".concat(n.height)),a.drawImage(e,0,0,e.width,e.height),a.save(),W(),console.log("onload")}},e.src=N(t)},e.src=_}}),[t,x,p]);var X=function(e){var t=Object(j.a)({},B);t.isLoading=e,E(S(t))},W=function(){var e,t,n=g.current,a=null!==(e=B.threshold1)&&void 0!==e?e:100,r=null!==(t=B.threshold2)&&void 0!==t?t:100,s=M.a.imread(n),l=new M.a.Mat;M.a.cvtColor(s,l,M.a.COLOR_BGR2GRAY);var u=new M.a.Mat;M.a.Canny(l,u,a,r),M.a.imshow(n,u);var b=n.getContext("2d"),f=b.getImageData(0,0,n.width,n.height);b.clearRect(0,0,n.width,n.height);var x=function(e){for(var t=new Uint8ClampedArray(e),n=0;n<t.length;n+=4){var a=255-t[n],r=255-t[n+1],s=255-t[n+2];255===a&&255===r&&255===s?t[n+3]=0:(a+=i,r+=c,s+=o),t[n]=a,t[n+1]=r,t[n+2]=s}return t}(Array.from(new Uint8Array(f.data.buffer))),p=new ImageData(x,n.width,n.height);b.putImageData(p,0,0),b.shadowBlur=1,b.shadowColor="rgb(".concat(i,", ").concat(c,", ").concat(o,")"),b.drawImage(n,0,0);var v=818-n.width/2,O=376-n.height/2;console.log("relativePosX: ".concat(v,", relativePosY: ").concat(O)),F({x:v,y:O}),L({x:0,y:0});var y=m.current;y.onload=Object(h.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,G(v,O);case 2:(t=Object(j.a)({},B)).isLoading=!1,void 0===t.threshold1&&(t.threshold1=a),void 0===t.threshold2&&(t.threshold2=r),E(S(t));case 7:case"end":return e.stop()}}),e)}))),y.src=n.toDataURL()},V=function(){var e=Object(h.a)(d.a.mark((function e(t){var n,a,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y){e.next=2;break}return e.abrupt("return");case 2:return n={x:t.pageX,y:t.pageY},a={x:n.x-C.x,y:n.y-C.y},r={x:T.x+a.x,y:T.y+a.y},L(n),F(r),e.next=9,G(r.x,r.y);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(z.jsx)(z.Fragment,{children:Object(z.jsxs)("div",{style:{position:"relative",padding:0,margin:0},children:[Object(z.jsx)("canvas",{ref:l,width:n,height:a,style:{position:"relative",width:"100%",zIndex:1}}),Object(z.jsx)("canvas",{ref:u,width:n,height:a,style:{position:"absolute",width:"100%",zIndex:2,top:0,left:0},onMouseDown:function(e){w(!0);var t={x:e.pageX,y:e.pageY};L(t),console.log("mouse down {x: ".concat(e.pageX,", y: ").concat(e.pageY,"}"))},onMouseUp:function(e){w(!1),console.log("mouse up")},onMouseMove:V}),Object(z.jsx)("canvas",{ref:g,width:n,height:a,style:{visibility:"hidden",width:"100%",zIndex:2,display:"none"}}),Object(z.jsx)("canvas",{ref:f,width:n,height:a,style:{visibility:"hidden",width:"100%",zIndex:2,display:"none"}}),Object(z.jsx)("img",{ref:x,style:{visibility:"hidden",display:"none"},alt:""}),Object(z.jsx)("img",{ref:p,style:{visibility:"hidden",display:"none"},alt:""}),Object(z.jsx)("img",{ref:m,style:{visibility:"hidden",display:"none"},alt:""})]})})},q=n(355),H=n(365),K=function(){return Object(z.jsx)(q.a,{position:"static",children:Object(z.jsx)(H.a,{children:Object(z.jsx)(y.a,{variant:"h6",component:"div",sx:{flexGrow:1},children:"Dalgona meme generator"})})})},Q=n(184),Z=n.n(Q),$=function(){return Object(z.jsx)(l.a,{id:"footer",maxWidth:"lg",sx:{marginTop:"15px",paddingTop:"15px",borderTop:"1px solid #eee"},children:Object(z.jsxs)(y.a,{component:"div",sx:{flexGrow:1},children:["Developed by ",Object(z.jsx)("a",{href:"https://rajephon.dev",target:"_blank",children:"rajephon"})," / ",Object(z.jsxs)("a",{href:"https://github.com/rajephon/dalgona-meme",target:"_blank",children:[Object(z.jsx)(Z.a,{fontSize:"inherit"})," Github"]}),Object(z.jsx)("br",{}),Object(z.jsx)("a",{href:"https://github.com/rajephon/dalgona-meme/issues",target:"_blank",children:"Report bug & issue"})]})})},ee=function(){var e=r.a.useRef(null);return r.a.useEffect((function(){var t;return null===e||void 0===e||null===(t=e.current)||void 0===t?void 0:t.scrollIntoView()})),Object(z.jsx)("div",{ref:e})},te=function(){var e=Object(b.c)((function(e){return e.resultImageState}));return Object(z.jsx)(l.a,{maxWidth:"lg",sx:{marginTop:"15px",paddingTop:"15px",borderTop:"1px solid #eee"},children:e.dataUrl&&Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)("img",{src:e.dataUrl,style:{width:"100%"}}),Object(z.jsx)(ee,{})]})})};var ne=function(){var e=r.a.useState(),t=Object(s.a)(e,2),n=t[0],a=t[1];return Object(z.jsxs)(z.Fragment,{children:[Object(z.jsx)(K,{}),Object(z.jsx)(l.a,{maxWidth:"lg",sx:{marginTop:"15px"},children:Object(z.jsxs)(o.a,{container:!0,spacing:2,children:[Object(z.jsx)(o.a,{item:!0,xs:12,md:8,children:Object(z.jsx)(V,{imgBuf:n})}),Object(z.jsx)(o.a,{item:!0,xs:12,md:4,children:Object(z.jsx)(G,{onClickGenerate:function(e){a(e)}})}),Object(z.jsx)(o.a,{item:!0,xs:12,md:12,children:Object(z.jsx)(te,{})})]})}),Object(z.jsx)($,{})]})},ae=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,366)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),i(e),c(e)}))},re=n(34),ie=Object(re.b)({dalgonaState:L,resultImageState:W}),ce=n(185),se=n.n(ce),oe=Object(I.a)({reducer:ie,middleware:function(e){return e().concat(se.a)}});c.a.render(Object(z.jsx)(r.a.StrictMode,{children:Object(z.jsx)(b.a,{store:oe,children:Object(z.jsx)(ne,{})})}),document.getElementById("root")),ae()}},[[305,1,2]]]);
//# sourceMappingURL=main.48b8ec2f.chunk.js.map