{"version":3,"sources":["slices/dalgona-state.ts","components/dalgona-form.tsx","js-canny-edge-detector/main.ts","js-canny-edge-detector/canny-edge-detector.ts","images/background.png","images/mask.png","components/dalgona-canvas.tsx","components/dalgona-header.tsx","components/dalgona-footer.tsx","App.tsx","reportWebVitals.ts","rootReducer.ts","store.ts","index.tsx"],"names":["dalgonaState","createSlice","name","initialState","scale","isLoading","download","reducers","changeDalgonaState","state","action","payload","actions","DalgonaForm","onClickGenerate","React","useState","imgFile","setImgFile","setScale","lt","setLt","ut","setUt","useSelector","dispatch","useDispatch","useEffect","newState","toFixed","console","log","onClickGenerateBtn","a","undefined","alert","arrayBuffer","imgFileBuf","onChangeSlider","setValueCallback","_","newValue","error","onChangeInput","e","target","value","Number","onChangeLowerThreshold","newLt","onChangeUpperThreshold","newUt","type","id","accept","onChange","currentTarget","files","length","file","disabled","Tooltip","title","htmlFor","IconButton","color","aria-label","component","fontSize","Box","Grid","container","spacing","alignItems","item","xs","Typography","gutterBottom","FormGroup","FormControlLabel","control","Checkbox","checked","event","label","Slider","track","aria-labelledby","valueLabelDisplay","step","min","max","Input","size","inputProps","style","marginTop","CircularProgress","Button","variant","onClick","startIcon","gaussMatrix","xMatrix","yMatrix","curry","f","n","args","Array","prototype","slice","call","arguments","apply","concat","canvas","image","getContext","drawImage","naturalWidth","naturalHeight","width","clearRect","height","bytes","putImageData","ImageData","Uint8ClampedArray","toConvolution","kernel","radius","time","kernx","kerny","convolution","i","j","innerI","innerJ","toDenormalized","normalized","denormalized","map","timeEnd","getMax","values","reduce","prev","now","getThresholds","gradientMagnitude","memo","x","filter","toPixels","expanded","forEach","push","detect","pixels","lowerThreshold","upperThreshold","eventCallback","toConvolutionForImg","grayscale","gray","toGrayscale","data","toNormalized","blurred","xDerived","yDerived","index","pom","gradientDirection","y","Math","sqrt","atan2","PI","gradientMagnitudeCapped","res","gradientMagnitudeLt","gradientMagnitudeUt","pass","nastavi","gradientMagnitudeCappedBottom","pom1","pom2","pom3","pom4","pom5","pom6","pom7","pom8","threshold","toGradientMagnitude","convertToImageDataUrl","imageBuffer","buffer","arr","Uint8Array","btoa","byte","String","fromCharCode","toBase64","DalgonaCanvas","imgBuf","CANVAS_BASE_WIDTH","CANVAS_BASE_HEIGHT","DALGONA_BORDER_COLOR","canvasBackgroundRef","useRef","canvasPictureRef","canvasEdgeRef","canvasDownloadRef","imagePictureRef","imageMaskRef","imageEdgeRef","isDragging","setIsDragging","mousePos","setMousePos","imageRelativePos","setImageRelativePos","downloadImage","buildPictureCanvasAsync","then","loadImageAsync","imageUrl","Promise","resolve","reject","img","Image","src","crossOrigin","onload","resetBackgroundAsync","current","ctx","backgroundImg","save","fixedX","fixedY","beginPath","translate","globalCompositeOperation","posX","posY","edgeImage","imWidth","parseInt","imHeight","restore","backgroundCanvas","pictureCanvas","downloadCanvas","downloadContext","url","toDataURL","link","document","createElement","href","setAttribute","body","appendChild","click","parentNode","removeChild","onLoading","imageMask","imagePicture","getImageData","onDetectCallback","maskImg","newDalgonaState","postprocess","r","g","b","canvasEdge","newImageData","shadowBlur","shadowColor","relativePosX","relativePosY","imageEdge","onMouseMove","newMousePos","pageX","pageY","gap","newImageRelativePos","position","padding","margin","ref","zIndex","top","left","onMouseDown","onMouseUp","visibility","display","alt","DalgonaHeader","AppBar","Toolbar","sx","flexGrow","DalgonaFooter","Container","maxWidth","paddingTop","borderTop","App","setImgBuf","md","newImgBuf","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","reducer","combineReducers","store","configureStore","middleware","getDefaultMiddleware","logger","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.1db476f4.chunk.js","sourcesContent":["// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\n\nexport interface DalgonaState {\n    scale: number;\n    isLoading: boolean;\n    ut?: number;\n    lt?: number;\n    download: boolean;\n}\n\nexport const dalgonaState = createSlice({\n    name: \"dalgona-state\",\n    initialState: {\n        scale: 1.0,\n        isLoading: false,\n        download: false,\n    } as DalgonaState,\n    reducers: {\n        changeDalgonaState(state, action: PayloadAction<DalgonaState>) {\n            return action.payload;\n        }\n    },\n})\n\nexport const { changeDalgonaState } = dalgonaState.actions;\nexport default dalgonaState.reducer;\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport React, {FunctionComponent} from \"react\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport {ReducerType} from \"../rootReducer\";\nimport Button from \"@mui/material/Button\";\nimport PhotoCamera from \"@mui/icons-material/PhotoCamera\";\nimport Tooltip from \"@mui/material/Tooltip\";\nimport IconButton from \"@mui/material/IconButton\";\nimport Slider from \"@mui/material/Slider\";\nimport Box from \"@mui/material/Box\";\nimport Typography from \"@mui/material/Typography\";\nimport Grid from \"@mui/material/Grid\";\nimport Input from \"@mui/material/Input\";\nimport Checkbox from \"@mui/material/Checkbox\";\nimport {DalgonaState, changeDalgonaState} from \"../slices/dalgona-state\";\nimport FormGroup from \"@mui/material/FormGroup\";\nimport FormControlLabel from \"@mui/material/FormControlLabel\";\nimport DownloadIcon from \"@mui/icons-material/Download\";\nimport AutoFixHighIcon from \"@mui/icons-material/AutoFixHigh\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\n\n\ndeclare namespace IDalgonaForm {\n    export interface IProp {\n        onClickGenerate: (imgBuf: ArrayBuffer) => void,\n    }\n}\n\nconst DalgonaForm: FunctionComponent<IDalgonaForm.IProp> = ({onClickGenerate}) => {\n    const [imgFile, setImgFile] = React.useState<File>();\n    const [scale, setScale] = React.useState<number | string>(1.0);\n    const [lt, setLt] = React.useState<number | string>(\"\");\n    const [ut, setUt] = React.useState<number | string>(\"\");\n    const dalgonaState = useSelector<ReducerType, DalgonaState>(state => state.dalgonaState);\n    const dispatch = useDispatch();\n\n    React.useEffect(() => {\n        if (typeof scale === \"number\") {\n            const newState = {...dalgonaState};\n            newState.scale = scale;\n            dispatch(changeDalgonaState(newState));\n        }\n    }, [scale]);\n\n    React.useEffect(() => {\n        if (dalgonaState.lt === lt)\n            return;\n\n        setLt(dalgonaState?.lt?.toFixed(2) ?? \"\");\n    }, [dalgonaState.lt]);\n\n    React.useEffect(() => {\n        if (dalgonaState.ut === ut)\n            return;\n        setUt(dalgonaState?.ut?.toFixed(2) ?? \"\");\n    }, [dalgonaState.ut]);\n\n    React.useEffect(() => {\n        console.log(`dalgonaState.isLoading: ${dalgonaState.isLoading}`);\n    }, [dalgonaState.isLoading])\n\n\n    const onClickGenerateBtn = async () => {\n        if (imgFile === undefined) {\n            alert(\"사용할 이미지를 선택해주세요.\");\n            return;\n        }\n\n        const imgFileBuf = await imgFile.arrayBuffer();\n\n        onClickGenerate(imgFileBuf);\n    }\n\n    const onChangeFileInput = (e: React.ChangeEvent<HTMLInputElement>) => {\n        console.log(e.target.value);\n        console.log(e.currentTarget.files);\n        if (e.currentTarget.files && e.currentTarget.files.length > 0) {\n            const file = e.currentTarget.files[0];\n            setImgFile(file);\n        }\n    }\n\n    const onChangeSlider = (setValueCallback: (value: number) => void) => {\n        return (_: Event, newValue: number | number[]) => {\n            if (typeof newValue === \"number\") {\n                setValueCallback(newValue as number);\n            } else {\n                console.error(`invalid type of newValue (type: ${typeof newValue})`);\n            }\n        }\n    }\n\n    const onChangeInput = (setValueCallback: (value: number | string) => void) => {\n        return (e: React.ChangeEvent<HTMLInputElement>) => {\n            setValueCallback((e.target.value === \"\") ? \"\" : Number(e.target.value));\n        }\n    }\n\n    const onChangeLowerThreshold = (newLt: number | string) => {\n        setLt(newLt);\n\n        const newState: DalgonaState = {...dalgonaState};\n        newState.lt = (typeof newLt === \"number\") ? newLt : undefined;\n        dispatch(changeDalgonaState(newState));\n    }\n\n    const onChangeUpperThreshold = (newUt: number | string) => {\n        setUt(newUt);\n\n        const newState: DalgonaState = {...dalgonaState};\n        newState.ut = (typeof newUt === \"number\") ? newUt : undefined;\n        dispatch(changeDalgonaState(newState));\n    }\n\n    const onChangeLtAutoCheckbox = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const checked = event.target.checked;\n        const newLt = checked ? \"\" : 0.01;\n\n        onChangeLowerThreshold(newLt);\n    }\n\n    const onChangeUtAutoCheckbox = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const checked = event.target.checked;\n        const newUt = checked ? \"\" : 0.5;\n\n        onChangeUpperThreshold(newUt);\n    }\n\n    const onClickDownloadBtn = () => {\n        const newState:DalgonaState = {...dalgonaState};\n        newState.download = true;\n        dispatch(changeDalgonaState(newState));\n    };\n\n    return (\n        <form>\n            <input type=\"file\" id=\"input-photo\" accept=\"image/*\" onChange={onChangeFileInput}\n                   disabled={dalgonaState.isLoading}/>\n            <Tooltip title=\"Select image\">\n                <>\n                    <label htmlFor=\"input-photo\">\n                        <IconButton color=\"primary\" aria-label=\"upload picture\" component=\"span\"\n                                    disabled={dalgonaState.isLoading}>\n                            <PhotoCamera fontSize=\"large\"/>\n                        </IconButton>\n                    </label>\n                    <Box>\n                        <Grid container spacing={2} alignItems=\"center\">\n                            <Grid item xs={6}>\n                                <Typography id=\"lt-slider\" gutterBottom>Lower Threshold (0-1)</Typography>\n                            </Grid>\n                            <Grid item xs={6}>\n                                <FormGroup>\n                                    <FormControlLabel control={<Checkbox\n                                        disabled={dalgonaState.isLoading}\n                                        checked={dalgonaState.lt === undefined}\n                                        onChange={onChangeLtAutoCheckbox}\n                                    />} label={\"auto\"}/>\n                                </FormGroup>\n                            </Grid>\n                        </Grid>\n                    </Box>\n                    <Box>\n                        <Grid container spacing={2} alignItems=\"center\">\n                            <Grid item xs={10}>\n                                <Slider track={false}\n                                        aria-labelledby=\"lt-slider\"\n                                        valueLabelDisplay=\"auto\"\n                                        value={dalgonaState.lt === undefined ? 0.0 : dalgonaState.lt}\n                                        onChange={onChangeSlider(onChangeLowerThreshold)}\n                                        step={0.01}\n                                        min={0}\n                                        max={1.0}\n                                        disabled={dalgonaState.isLoading}\n                                />\n                            </Grid>\n                            <Grid item xs>\n                                <Input\n                                    value={lt}\n                                    size=\"small\"\n                                    inputProps={{\n                                        min: 0,\n                                        max: 1,\n                                        step: 0.01,\n                                        type: \"number\",\n                                        'aria-labelledby': \"lt-slider\",\n                                    }}\n                                    onChange={onChangeInput(onChangeLowerThreshold)}\n                                    disabled={dalgonaState.isLoading}\n                                />\n                            </Grid>\n                        </Grid>\n                    </Box>\n\n                    <Box>\n                        <Grid container spacing={2} alignItems=\"center\">\n                            <Grid item xs={6}>\n                                <Typography id=\"ut-slider\" gutterBottom>\n                                    Upper Threshold (0-1)\n                                </Typography>\n                            </Grid>\n                            <Grid item xs={6}>\n                                <FormGroup>\n                                    <FormControlLabel control={<Checkbox\n                                        disabled={dalgonaState.isLoading}\n                                        checked={dalgonaState.ut === undefined}\n                                        onChange={onChangeUtAutoCheckbox}\n                                    />} label={\"auto\"}/>\n                                </FormGroup>\n                            </Grid>\n                        </Grid>\n                    </Box>\n                    <Box>\n                        <Grid container spacing={2} alignItems=\"center\">\n                            <Grid item xs={10}>\n                                <Slider track={false}\n                                        aria-labelledby=\"ut-slider\"\n                                        valueLabelDisplay=\"auto\"\n                                        value={dalgonaState?.ut ?? 0.0}\n                                        onChange={onChangeSlider(onChangeUpperThreshold)}\n                                        step={0.01}\n                                        min={0}\n                                        max={1.0}\n                                        disabled={dalgonaState.isLoading}\n                                />\n                            </Grid>\n                            <Grid item xs>\n                                <Input\n                                    value={ut}\n                                    size=\"small\"\n                                    inputProps={{\n                                        min: 0,\n                                        max: 1,\n                                        step: 0.01,\n                                        type: \"number\",\n                                        'aria-labelledby': \"ut-slider\",\n                                    }}\n                                    onChange={onChangeInput(onChangeUpperThreshold)}\n                                    disabled={dalgonaState.isLoading}\n                                />\n                            </Grid>\n                        </Grid>\n                    </Box>\n                    <Box>\n                        <Typography id=\"scale-slider\" gutterBottom>\n                            Image scale\n                        </Typography>\n                        <Grid container spacing={2} alignItems=\"center\">\n                            <Grid item xs={10}>\n                                <Slider track={false}\n                                        aria-labelledby=\"scale-slider\"\n                                        valueLabelDisplay=\"auto\"\n                                        value={typeof scale === \"number\" ? scale : 1.0}\n                                        onChange={onChangeSlider(setScale)}\n                                        step={0.1}\n                                        min={0.1}\n                                        max={2.0}\n                                        disabled={dalgonaState.isLoading}\n                                />\n                            </Grid>\n                            <Grid item xs>\n                                <Input\n                                    value={scale}\n                                    size=\"small\"\n                                    inputProps={{\n                                        min: 0.1,\n                                        max: 2,\n                                        step: 0.1,\n                                        type: \"number\",\n                                        'aria-labelledby': \"scale-slider\",\n                                    }}\n                                    onChange={onChangeInput(setScale)}\n                                    disabled={dalgonaState.isLoading}\n                                />\n                            </Grid>\n                        </Grid>\n                    </Box>\n                    <Box style={{marginTop:\"18px\"}}>\n                        <Grid container spacing={2} alignItems=\"center\">\n                            {dalgonaState.isLoading ?\n                                <>\n                                    <Grid item xs={5} />\n                                    <Grid item xs={2}>\n                                        <CircularProgress/>\n                                    </Grid>\n                                    <Grid item xs={5} />\n                                </>\n                                :\n                                <>\n                                    <Grid item xs={6}>\n                                        <Button\n                                            variant=\"outlined\"\n                                            onClick={onClickGenerateBtn}\n                                            startIcon={<AutoFixHighIcon/>} >\n                                            Generate\n                                        </Button>\n                                    </Grid>\n                                    <Grid item xs={6}>\n                                        <Button variant=\"outlined\"\n                                                onClick={onClickDownloadBtn}\n                                                startIcon={<DownloadIcon/>} >\n                                            Download\n                                        </Button>\n                                    </Grid>\n                                </>\n                            }\n\n                        </Grid>\n                    </Box>\n                </>\n            </Tooltip>\n        </form>\n    )\n};\n\nexport default DalgonaForm;\n","// implemented from https://github.com/petarjs/js-canny-edge-detector\n\nconst MAX_PRECISION = false\nconst precision = 2\n\nexport const gaussMatrix = [\n    [0.0121, 0.0261, 0.0337, 0.0261, 0.0121],\n    [0.0261, 0.0561, 0.0724, 0.0561, 0.0261],\n    [0.0337, 0.0724, 0.0935, 0.0724, 0.0337],\n    [0.0261, 0.0561, 0.0724, 0.0561, 0.0261],\n    [0.0121, 0.0261, 0.0337, 0.0261, 0.0121]\n]\n\nexport const xMatrix = [ [ 1, 0, -1 ], [ 2, 0, -2 ], [ 1, 0, -1 ] ]\nexport const yMatrix = [ [ -1, -2, -1 ], [ 0, 0, 0 ], [ 1, 2, 1 ] ]\n\nexport const MAX_IMAGE_HEIGHT = 300\n\nfunction curry(f: Function, n?: number): Function {\n    const args = Array.prototype.slice.call(arguments, 0);\n    if (typeof n === 'undefined')\n        args[1] = f.length;\n    if (n === args.length - 2)\n        return f.apply(undefined, args.slice(2));\n    return function() {\n        // @ts-ignore\n        return curry.apply(undefined, args.concat(Array.prototype.slice.call(arguments, 0)));\n    };\n}\n\n// function loadImage(imageUrl: string) {\n//     return new Promise ((resolve, reject) => {\n//         console.time('loadImage')\n//         const img = new Image()\n//         img.src = imageUrl\n//         img.crossOrigin = 'Anonymous'\n//         img.onload = function () {\n//             console.timeEnd('loadImage')\n//             resolve(img)\n//         }\n//     })\n// }\n\nfunction _drawImageOnCanvas(canvas: HTMLCanvasElement, image: CanvasImageSource) {\n    canvas.getContext('2d')?.drawImage(image, 0, 0)\n    return image\n}\n\nconst drawImageOnCanvas = curry(_drawImageOnCanvas)\n\nfunction _setCanvasSizeFromImage(canvas: HTMLCanvasElement, image: HTMLImageElement) {\n    const ratio = image.naturalWidth / image.naturalHeight\n    canvas.style.width = ''\n    canvas.getContext('2d')?.clearRect(0, 0, image.width, image.height);\n    canvas.height = image.height\n    canvas.width = image.width\n    return image\n}\n\nconst setCanvasSizeFromImage = curry(_setCanvasSizeFromImage)\n\nfunction _drawBytesOnCanvas(width: number, height: number, canvas: HTMLCanvasElement, bytes: Uint8Array) {\n    canvas.getContext('2d')?.putImageData(\n            new ImageData(new Uint8ClampedArray(\n                bytes\n            ), width, height),\n            0, 0\n        )\n}\n\nconst drawBytesOnCanvas = curry(_drawBytesOnCanvas)\n\nexport function toGrayscale(bytes: Uint8Array, width: number, height: number): Array<number> {\n    console.time('toGrayscale')\n    const grayscale = []\n    for (let i = 0; i < bytes.length; i += 4) {\n        var gray = .299 * bytes[i + 2] + .587 * bytes[i + 1] + .114 * bytes[i]\n        grayscale.push(gray)\n    }\n    console.timeEnd('toGrayscale')\n\n    return grayscale\n}\n\nfunction _toConvolution (width: number, height: number, kernel: number[][], radius: number, bytes: Uint8Array): number[] {\n    console.time('toConvolution')\n    const convolution = []\n    let newValue, idxX, idxY, kernx, kerny\n    for (let i = 0; i < width; i++) {\n        for (let j = 0; j < height; j++) {\n            newValue = 0\n            for (let innerI = i - radius; innerI < i + radius + 1; innerI++) {\n                for (let innerJ = j - radius; innerJ < j + radius + 1; innerJ++) {\n                    idxX = (innerI + width) % width\n                    idxY = (innerJ + height) % height\n\n                    kernx = innerI - (i - radius)\n                    kerny = innerJ - (j - radius)\n                    newValue += bytes[idxY * width + idxX] * kernel[kernx][kerny]\n\n                }\n            }\n            convolution[j * width + i] = newValue\n        }\n    }\n    console.time('toConvolution')\n\n    return convolution\n}\n\nexport const toConvolution = curry(_toConvolution)\n\n/**\n * From image bytes (0 - 255) to values between 0 and 1\n * @param  {Array<number>} bytes\n * @return {Array}      normalized values\n */\nexport function toNormalized(bytes: Array<number>): Array<number> {\n    console.time('toNormalized')\n\n    const normalized = []\n    for (let i = 0; i < bytes.length; i += 4) {\n        normalized.push(bytes[i] / 255)\n    }\n    console.timeEnd('toNormalized')\n\n    return normalized\n}\n\n/**\n * From normalized array that has values from 0 to 1\n * to image data with values between 0 and 255\n * @param  {Array}  normalized\n * @return {Array}  denormlized\n */\nexport function toDenormalized(normalized: Array<number>): Array<number> {\n    console.time('toDenormalized')\n    const denormalized =  normalized.map(value => value * 255)\n    console.timeEnd('toDenormalized')\n    return denormalized\n}\n\nexport function toGradientMagnitude(\n    xDerived: Array<number>,\n    yDerived: Array<number>,\n    width: number,\n    height: number,\n    lt = 0,\n    ut = 0): any {\n\n    console.time('toGradientMagnitude')\n    const gradientMagnitude = []\n    const gradientDirection = []\n\n    let index\n    let pom\n\n    for (let y = 0; y < height; y++) {\n        for (let x = 0; x < width; x++) {\n            index = y * width + x\n            gradientMagnitude[index] = Math.sqrt(xDerived[index] * xDerived[index] + yDerived[index] * yDerived[index])\n            pom = Math.atan2(xDerived[index], yDerived[index]);\n            if ((pom >= -Math.PI / 8 && pom < Math.PI / 8) || (pom <= -7 * Math.PI / 8 && pom > 7 * Math.PI / 8)) {\n                gradientDirection[index] = 0;\n            } else if ((pom >= Math.PI / 8 && pom < 3 * Math.PI / 8) || (pom <= -5 * Math.PI / 8 && pom > -7 * Math.PI / 8)) {\n                gradientDirection[index] = Math.PI / 4;\n            } else if ((pom >= 3 * Math.PI / 8 && pom <= 5 * Math.PI / 8) || (-3 * Math.PI / 8 >= pom && pom > -5 * Math.PI / 8)) {\n                gradientDirection[index] = Math.PI / 2;\n            } else if ((pom < -Math.PI / 8 && pom >= -3 * Math.PI / 8) || (pom > 5 * Math.PI / 8 && pom <= 7 * Math.PI / 8)) {\n                gradientDirection[index] = -Math.PI / 4;\n            }\n        }\n    }\n\n    const max = getMax(gradientMagnitude)\n    const gradientMagnitudeCapped = gradientMagnitude.map(x => x / max)\n\n    if (!ut && !lt) {\n        let res = getThresholds(gradientMagnitudeCapped)\n        ut = res.ut\n        lt = res.lt\n    }\n\n    const gradientMagnitudeLt = gradientMagnitudeCapped.map(value => value < lt ? 0 : value)\n\n    for (let y = 1; y < height - 1; y++) {\n        for (let x = 1; x < width - 1; x++) {\n            index = y * width + x\n\n            if (gradientDirection[index] == 0 && (gradientMagnitudeLt[index] <= gradientMagnitudeLt[y * width + x - 1] || gradientMagnitudeLt[index] <= gradientMagnitudeLt[y * width + x + 1]))\n                gradientMagnitudeLt[index] = 0;\n            else if (gradientDirection[index] == Math.PI / 2 && (gradientMagnitudeLt[index] <= gradientMagnitudeLt[(y - 1) * width + x] || gradientMagnitudeLt[(y + 1) * width + x] >= gradientMagnitudeLt[index]))\n                gradientMagnitudeLt[index] = 0;\n            else if (gradientDirection[index] == Math.PI / 4 && (gradientMagnitudeLt[index] <= gradientMagnitudeLt[(y + 1) * width + x - 1] || gradientMagnitudeLt[index] <= gradientMagnitudeLt[(y - 1) * width + x + 1]))\n                gradientMagnitudeLt[index] = 0;\n            else if (gradientDirection[index] == -Math.PI / 4 && (gradientMagnitudeLt[index] <= gradientMagnitudeLt[(y - 1) * width + x - 1] || gradientMagnitudeLt[index] <= gradientMagnitudeLt[(y + 1) * width + x + 1]))\n                gradientMagnitudeLt[index] = 0;\n        }\n    }\n\n    for (let y = 2; y < height - 2; y++) {\n        for (let x = 2; x < width - 2; x++) {\n            if (gradientDirection[y * width + x] == 0)\n                if (gradientMagnitudeLt[y * width + x - 2] > gradientMagnitudeLt[y * width + x] || gradientMagnitudeLt[y * width + x + 2] > gradientMagnitudeLt[y * width + x])\n                    gradientMagnitudeLt[y * width + x] = 0;\n            if (gradientDirection[y * width + x] == Math.PI / 2)\n                if (gradientMagnitudeLt[(y - 2) * width + x] > gradientMagnitudeLt[y * width + x] || gradientMagnitudeLt[(y + 2) * width + x] > gradientMagnitudeLt[y * width + x])\n                    gradientMagnitudeLt[y * width + x] = 0;\n            if (gradientDirection[y * width + x] == Math.PI / 4)\n                if (gradientMagnitudeLt[(y + 2) * width + x - 2] > gradientMagnitudeLt[y * width + x] || gradientMagnitudeLt[(y - 2) * width + x + 2] > gradientMagnitudeLt[y * width + x])\n                    gradientMagnitudeLt[y * width + x] = 0;\n            if (gradientDirection[y * width + x] == -Math.PI / 4)\n                if (gradientMagnitudeLt[(y + 2) * width + x + 2] > gradientMagnitudeLt[y * width + x] || gradientMagnitudeLt[(y - 2) * width + x - 2] > gradientMagnitudeLt[y * width + x])\n                    gradientMagnitudeLt[y * width + x] = 0;\n        }\n    }\n\n    const gradientMagnitudeUt:number[] = gradientMagnitudeLt.map(value => value > ut ? 1 : value)\n\n    // histeresis start\n    let pomH = 0\n    let pomOld = -1\n    let pass = 0\n\n    let nastavi = true\n    let gradientMagnitudeCappedBottom:number[] = []\n    while ( nastavi ) {\n        pass = pass + 1;\n        pomOld = pomH;\n        for (let y = 1; y < height - 1; y++) {\n            for (let x = 1; x < width - 1; x++) {\n                if (gradientMagnitudeUt[y * width + x] <= ut && gradientMagnitudeUt[y * width + x] >= lt) {\n                    let pom1 = gradientMagnitudeUt[(y - 1) * width + x - 1];\n                    let pom2 = gradientMagnitudeUt[(y - 1) * width + x];\n                    let pom3 = gradientMagnitudeUt[(y - 1) * width + x + 1];\n                    let pom4 = gradientMagnitudeUt[y * width + x - 1];\n                    let pom5 = gradientMagnitudeUt[y * width + x + 1];\n                    let pom6 = gradientMagnitudeUt[(y + 1) * width + x - 1];\n                    let pom7 = gradientMagnitudeUt[(y + 1) * width + x];\n                    let pom8 = gradientMagnitudeUt[(y + 1) * width + x + 1];\n\n                    if (pom1 === 1 || pom2 === 1 || pom3 === 1 || pom4 === 1 || pom5 === 1 || pom6 === 1 || pom7 === 1 || pom8 === 1) {\n                        gradientMagnitudeUt[y * width + x] = 1;\n                        pomH = pomH + 1;\n                    }\n                }\n            }\n        }\n\n        if (MAX_PRECISION) {\n            nastavi = pomH != pomOld;\n        } else {\n            nastavi = pass <= precision;\n        }\n\n        gradientMagnitudeCappedBottom = gradientMagnitudeUt.map(x => x <= ut ? 0 : x)\n    }\n\n    console.timeEnd('toGradientMagnitude')\n    return {\n        data: gradientMagnitudeCappedBottom,\n        threshold: {\n            ut: ut,\n            lt: lt\n        }\n    }\n\n}\n\nfunction getMax(values: Array<number>): number {\n    return values.reduce((prev, now) => now > prev ? now : prev, -1)\n}\n\nfunction getThresholds(gradientMagnitude: Array<number>): { ut: number, lt: number } {\n    let sum = 0;\n    let count = 0;\n\n    sum = gradientMagnitude.reduce((memo, x) => x + memo, 0)\n    count = gradientMagnitude.filter(x => x !== 0).length\n\n    const ut = sum / count\n    const lt = 0.4 * ut\n    return { ut, lt }\n}\n\n/**\n * Takes an array of values (0-255) and returns\n * an expaneded array [x, x, x, 255] for each value.\n *\n * @param  {Array}  values\n * @return {Array}  expanded values\n */\nexport function toPixels(values: Array<number>): Array<number> {\n    console.time('toPixels')\n    const expanded:number[] = []\n    values.forEach(x => {\n        expanded.push(x)\n        expanded.push(x)\n        expanded.push(x)\n        expanded.push(255)\n    })\n\n    console.timeEnd('toPixels')\n    return expanded\n}\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport {\n    gaussMatrix,\n    toConvolution, toDenormalized,\n    toGradientMagnitude,\n    toGrayscale,\n    toNormalized,\n    toPixels,\n    xMatrix,\n    yMatrix\n} from \"./main\";\n\n\nexport function detect(pixels: Uint8Array, width: number, height: number, lowerThreshold: number|undefined,\n                      upperThreshold: number|undefined, eventCallback:(data:{type:string,data?:number[], threshold?:{lt:number,ut:number}})=>void) {\n\n\n    const toConvolutionForImg = toConvolution(width, height);\n    const grayscale = toPixels(toGrayscale(pixels, width, height));\n    eventCallback({ type: 'grayscale', data: grayscale });\n\n    const normalized = toNormalized(grayscale)\n    eventCallback({type: 'normalized'});\n\n    const blurred = toConvolutionForImg(gaussMatrix, 2, normalized)\n    eventCallback({ type: 'blurred', data: toPixels(toDenormalized(blurred))});\n\n    const xDerived = toConvolutionForImg(xMatrix, 1, blurred)\n    eventCallback({type: 'xAxis', data: toPixels(toDenormalized(xDerived))});\n\n    const yDerived = toConvolutionForImg(yMatrix, 1, blurred)\n    eventCallback({type:'yAxis', data:toPixels(toDenormalized(yDerived))});\n\n    if (lowerThreshold) {\n        if (lowerThreshold > 1)\n            lowerThreshold = 1;\n\n        if (lowerThreshold < 0)\n            lowerThreshold = 0;\n    }\n    if (upperThreshold) {\n        if (upperThreshold > 1)\n            upperThreshold = 1;\n\n        if (upperThreshold < 0)\n            upperThreshold = 0;\n    }\n\n    const gradientMagnitude = toGradientMagnitude(xDerived, yDerived, width, height, lowerThreshold, upperThreshold);\n    eventCallback({type:'gradientMagnitude', data: toPixels(toDenormalized(gradientMagnitude.data)), threshold: gradientMagnitude.threshold});\n\n}\n","export default __webpack_public_path__ + \"static/media/background.d52b6394.png\";","export default __webpack_public_path__ + \"static/media/mask.5c3c32d3.png\";","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport React, {FunctionComponent} from \"react\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport {ReducerType} from \"../rootReducer\";\nimport {DalgonaState, changeDalgonaState} from \"../slices/dalgona-state\";\nimport {detect} from \"../js-canny-edge-detector/canny-edge-detector\";\nimport backgroundImg from \"../images/background.png\";\nimport maskImg from \"../images/mask.png\";\n\ndeclare namespace IDalgonaCanvas {\n    export interface IProps {\n        imgBuf?: ArrayBuffer,\n    }\n}\n\nconst toBase64 = (buffer: ArrayBuffer) => {\n    const arr = new Uint8Array(buffer)\n    return btoa(\n        arr.reduce((data, byte) => data + String.fromCharCode(byte), '')\n    );\n}\n\nconst convertToImageDataUrl = (imageBuffer: ArrayBuffer) => `data:image/png;base64,${toBase64(imageBuffer)}`\n\nconst DalgonaCanvas: FunctionComponent<IDalgonaCanvas.IProps> = ({imgBuf}) => {\n    const CANVAS_BASE_WIDTH = 1543;\n    const CANVAS_BASE_HEIGHT = 770;\n\n    const BASE_POS_X = 818;\n    const BASE_POS_Y = 376;\n\n    // const border\n    const DALGONA_BORDER_COLOR = {\n        r: 82,\n        g: 48,\n        b: 12\n    }\n\n    const canvasBackgroundRef = React.useRef<HTMLCanvasElement>(null);\n    const canvasPictureRef = React.useRef<HTMLCanvasElement>(null);\n    const canvasEdgeRef = React.useRef<HTMLCanvasElement>(null);\n    const canvasDownloadRef = React.useRef<HTMLCanvasElement>(null);\n\n    const imagePictureRef = React.useRef<HTMLImageElement>(null);\n    const imageMaskRef = React.useRef<HTMLImageElement>(null);\n    const imageEdgeRef = React.useRef<HTMLImageElement>(null);\n\n    const [isDragging, setIsDragging] = React.useState<boolean>(false);\n    const [mousePos, setMousePos] = React.useState<{ x: number, y: number }>({x: 0, y: 0});\n    const [imageRelativePos, setImageRelativePos] = React.useState<{ x: number, y: number }>({\n        x: BASE_POS_X,\n        y: BASE_POS_Y\n    });\n\n    const dalgonaState = useSelector<ReducerType, DalgonaState>(state => state.dalgonaState);\n    const dispatch = useDispatch();\n\n    React.useEffect(() => {\n        if (dalgonaState.download) {\n            downloadImage();\n            const newState:DalgonaState = {...dalgonaState};\n            newState.download = false;\n            dispatch(changeDalgonaState(newState));\n        }\n    }, [dalgonaState.download]);\n\n    React.useEffect(() => {\n        buildPictureCanvasAsync(imageRelativePos.x, imageRelativePos.y).then();\n    }, [dalgonaState.scale]);\n\n    const loadImageAsync = async (imageUrl: string): Promise<HTMLImageElement> => {\n        return new Promise(((resolve, reject) => {\n            const img = new Image()\n            img.src = imageUrl\n            img.crossOrigin = 'Anonymous'\n            img.onload = function () {\n                console.timeEnd('loadImage')\n                resolve(img)\n            }\n        }));\n    }\n\n    const resetBackgroundAsync = async () => {\n        if (typeof canvasBackgroundRef === \"undefined\") {\n            console.time(\"canvasBackgroundRef is undefined\");\n            return;\n        }\n        const canvas = canvasBackgroundRef.current;\n        if (canvas === null) {\n            console.log(\"canvasBackgroundRef.current is null\");\n            return;\n        }\n        const ctx = canvas.getContext(\"2d\");\n        if (ctx === null)\n            return;\n        ctx.drawImage(await loadImageAsync(backgroundImg), 0, 0);\n        ctx.save();\n    }\n\n\n    const buildPictureCanvasAsync = async (fixedX: number, fixedY: number) => {\n        if (typeof canvasPictureRef === \"undefined\" || canvasPictureRef === null) {\n            console.time(\"canvasPictureRef is undefined or null\");\n            return;\n        }\n        if (imagePictureRef === null) {\n            console.time(\"imageRef is null\");\n            return;\n        }\n\n        const canvas = canvasPictureRef.current;\n        if (canvas === null) {\n            console.log(\"canvasPictureRef.current is null\");\n            return;\n        }\n\n        const ctx = canvas.getContext(\"2d\");\n        if (ctx === null)\n            return;\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        ctx.beginPath();\n\n        // mask for clipping\n        ctx.drawImage(imageMaskRef.current!, 0, 0);\n        ctx.save();\n\n        ctx.translate(CANVAS_BASE_WIDTH / 2, CANVAS_BASE_HEIGHT / 2);\n\n        ctx.globalCompositeOperation = \"source-in\";\n\n        // // calculate position\n        const posX = (-CANVAS_BASE_WIDTH / 2 + fixedX) * dalgonaState.scale;\n        const posY = (-CANVAS_BASE_HEIGHT / 2 + fixedY) * dalgonaState.scale;\n\n        console.log(`posX: ${posX}, posY: ${posY}`);\n\n        const edgeImage = imageEdgeRef.current!;\n        const imWidth = parseInt(edgeImage.width + '') * dalgonaState.scale;\n        const imHeight = parseInt(edgeImage.height + '') * dalgonaState.scale;\n        ctx.drawImage(edgeImage, posX, posY, imWidth, imHeight);\n\n        ctx.restore();\n    }\n\n    const downloadImage = () => {\n        const backgroundCanvas = canvasBackgroundRef.current!;\n        const pictureCanvas = canvasPictureRef.current!;\n\n        const downloadCanvas = canvasDownloadRef.current!;\n        const downloadContext = downloadCanvas.getContext('2d')!;\n\n        downloadContext.drawImage(backgroundCanvas, 0, 0);\n        downloadContext.drawImage(pictureCanvas, 0, 0);\n\n        const url = downloadCanvas.toDataURL();\n\n        const link = document.createElement(\"a\");\n        link.href = url;\n        link.setAttribute(\n            \"download\",\n            \"dalgona.png\",\n        );\n        document.body.appendChild(link);\n        link.click();\n        link.parentNode?.removeChild(link);\n    }\n\n    React.useEffect(() => {\n        resetBackgroundAsync().then();\n    }, [canvasBackgroundRef]);\n\n    React.useEffect(() => {\n        if (imgBuf === undefined)\n            return;\n        if (imagePictureRef === null)\n            return;\n        if (imageMaskRef === null)\n            return;\n\n        onLoading(true);\n\n\n        const imageMask = imageMaskRef.current!;\n        imageMask.onload = () => {\n            const imagePicture = imagePictureRef.current!;\n            imagePicture.onload = () => {\n                if (imgBuf === undefined)\n                    return;\n\n                const canvas = canvasEdgeRef.current!;\n                const ctx = canvas.getContext('2d')!;\n                ctx.clearRect(0, 0, imagePicture.width, imagePicture.height);\n                canvas.height = imagePicture.height;\n                canvas.width = imagePicture.width;\n                console.log(`width: ${canvas.width}`);\n                console.log(`height: ${canvas.height}`);\n\n                ctx.drawImage(imagePicture, 0, 0, imagePicture.width, imagePicture.height);\n                ctx.save();\n                const imageData = ctx!.getImageData(0, 0, imagePicture.width, imagePicture.height);\n                detect(imageData.data as any as Uint8Array, imagePicture.width, imagePicture.height, dalgonaState.lt, dalgonaState.ut, onDetectCallback);\n\n                console.log(\"onload\");\n            };\n            imagePicture.src = convertToImageDataUrl(imgBuf);\n\n        }\n        imageMask.src = maskImg;\n    }, [imgBuf, imagePictureRef, imageMaskRef]);\n\n    const onLoading = (isLoading: boolean) => {\n        const newDalgonaState:DalgonaState = {...dalgonaState};\n        newDalgonaState.isLoading = isLoading;\n        dispatch(changeDalgonaState(newDalgonaState));\n    }\n\n    const postprocess = (buffer: number[]): Uint8ClampedArray => {\n        const pixels = new Uint8ClampedArray(buffer);\n\n        // 색상 반전 및\n        for (let i = 0; i < pixels.length; i += 4) {\n            // 색상 뒤짚기\n            let r = 255 - pixels[i];\n            let g = 255 - pixels[i + 1];\n            let b = 255 - pixels[i + 2];\n\n            if (r === 255 && g === 255 && b === 255) {\n                pixels[i + 3] = 0;\n            } else {\n                r += DALGONA_BORDER_COLOR.r;\n                g += DALGONA_BORDER_COLOR.g;\n                b += DALGONA_BORDER_COLOR.b;\n            }\n\n            pixels[i] = r;\n            pixels[i + 1] = g;\n            pixels[i + 2] = b;\n        }\n\n        return pixels;\n    }\n\n    const onDetectCallback = async ({\n                                        type,\n                                        data,\n                                        threshold\n                                    }: { type: string, data?: number[], threshold?: { lt: number, ut: number } }) => {\n        console.log(`type: ${type}`);\n        if (data === undefined)\n            return;\n        const canvasEdge = canvasEdgeRef.current!;\n        const ctx = canvasEdge!.getContext('2d')!;\n        ctx.clearRect(0, 0, canvasEdge.width, canvasEdge.height)\n\n        const pixels = postprocess(data);\n\n        const newImageData = new ImageData(pixels, canvasEdge.width, canvasEdge.height);\n        ctx.putImageData(newImageData, 0, 0);\n\n        // 덧칠\n        ctx.shadowBlur = 1;\n        ctx.shadowColor = `rgb(${DALGONA_BORDER_COLOR.r}, ${DALGONA_BORDER_COLOR.g}, ${DALGONA_BORDER_COLOR.b})`;\n        ctx.drawImage(canvasEdge, 0, 0);\n\n        const relativePosX = BASE_POS_X - (canvasEdge.width / 2);\n        const relativePosY = BASE_POS_Y - (canvasEdge.height / 2);\n        console.log(`relativePosX: ${relativePosX}, relativePosY: ${relativePosY}`);\n        setImageRelativePos({x: relativePosX, y: relativePosY});\n        setMousePos({x: 0, y: 0});\n\n\n        const imageEdge = imageEdgeRef.current!;\n        imageEdge.onload = async () => {\n            await buildPictureCanvasAsync(relativePosX, relativePosY);\n\n            const newState = {...dalgonaState};\n            newState.isLoading = false;\n            if (threshold) {\n                newState.lt = threshold.lt;\n                newState.ut = threshold.ut;\n            }\n            dispatch(changeDalgonaState(newState));\n        }\n\n        imageEdge.src = canvasEdge.toDataURL();\n\n    }\n\n    const onMouseMove = async (e: React.MouseEvent<HTMLCanvasElement>) => {\n        if (!isDragging) {\n            return;\n        }\n\n        const newMousePos = {x: e.pageX, y: e.pageY};\n        const gap = {\n            x: newMousePos.x - mousePos.x,\n            y: newMousePos.y - mousePos.y\n        };\n\n        const newImageRelativePos = {\n            x: imageRelativePos.x + gap.x,\n            y: imageRelativePos.y + gap.y\n        }\n\n        setMousePos(newMousePos);\n        setImageRelativePos(newImageRelativePos);\n\n        await buildPictureCanvasAsync(newImageRelativePos.x, newImageRelativePos.y);\n    }\n\n    const onMouseDown = (e: React.MouseEvent<HTMLCanvasElement>) => {\n        setIsDragging(true);\n        const newMousePos = {x: e.pageX, y: e.pageY};\n        setMousePos(newMousePos);\n\n        console.log(`mouse down {x: ${e.pageX}, y: ${e.pageY}}`);\n    }\n    const onMouseUp = (_: React.MouseEvent<HTMLCanvasElement>) => {\n        setIsDragging(false);\n        console.log(\"mouse up\")\n    }\n\n    return (\n        <>\n            <div style={{position: \"relative\", padding: 0, margin: 0}}>\n                <canvas ref={canvasBackgroundRef} width={CANVAS_BASE_WIDTH} height={CANVAS_BASE_HEIGHT}\n                        style={{position: \"relative\", width: \"100%\", zIndex: 1}}/>\n                <canvas ref={canvasPictureRef} width={CANVAS_BASE_WIDTH} height={CANVAS_BASE_HEIGHT}\n                        style={{position: \"absolute\", width: \"100%\", zIndex: 2, top: 0, left: 0}}\n                        onMouseDown={onMouseDown} onMouseUp={onMouseUp} onMouseMove={onMouseMove}/>\n                <canvas ref={canvasEdgeRef} width={CANVAS_BASE_WIDTH} height={CANVAS_BASE_HEIGHT}\n                        style={{visibility: \"hidden\", width: \"100%\", zIndex: 2, display: \"none\"}}/>\n                <canvas ref={canvasDownloadRef} width={CANVAS_BASE_WIDTH} height={CANVAS_BASE_HEIGHT}\n                        style={{visibility: \"hidden\", width: \"100%\", zIndex: 2, display: \"none\"}}/>\n                <img ref={imagePictureRef} style={{visibility: \"hidden\", display: \"none\"}} alt=\"\"/>\n                <img ref={imageMaskRef} style={{visibility: \"hidden\", display: \"none\"}} alt=\"\"/>\n                <img ref={imageEdgeRef} style={{visibility: \"hidden\", display: \"none\"}} alt=\"\"/>\n            </div>\n        </>\n    );\n}\n\nexport default DalgonaCanvas;\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport React from \"react\";\nimport Typography from \"@mui/material/Typography\";\nimport AppBar from \"@mui/material/AppBar\";\nimport Toolbar from '@mui/material/Toolbar';\n\nconst DalgonaHeader = () => {\n    return <AppBar position={\"static\"}>\n        <Toolbar>\n            <Typography variant=\"h6\" component=\"div\" sx={{flexGrow: 1}}>\n                Dalgona meme generator\n            </Typography>\n        </Toolbar>\n    </AppBar>;\n}\n\nexport default DalgonaHeader;\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport React from \"react\";\nimport Container from \"@mui/material/Container\";\nimport Typography from \"@mui/material/Typography\";\nimport GitHubIcon from '@mui/icons-material/GitHub';\n\n\nconst DalgonaFooter = () => {\n    return <Container id=\"footer\" maxWidth={\"lg\"} sx={{marginTop: \"15px\", paddingTop: \"15px\", borderTop:\"1px solid #eee\"}}>\n        <Typography component=\"div\" sx={{flexGrow: 1}}>\n            Developed by <a href=\"https://rajephon.dev\" target=\"_blank\">rajephon</a> / <a href=\"https://github.com/rajephon/dalgona-meme\" target=\"_blank\"><GitHubIcon fontSize=\"inherit\" /> Github</a><br />\n            <a href=\"https://github.com/rajephon/dalgona-meme/issues\" target=\"_blank\">Report bug &amp; issue</a>\n        </Typography>\n\n    </Container>;\n}\n\nexport default DalgonaFooter;\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport React from 'react';\nimport './App.css';\nimport Grid from \"@mui/material/Grid\";\nimport Container from \"@mui/material/Container\";\nimport DalgonaForm from \"./components/dalgona-form\";\nimport DalgonaCanvas from \"./components/dalgona-canvas\";\nimport DalgonaHeader from \"./components/dalgona-header\";\nimport DalgonaFooter from \"./components/dalgona-footer\";\n\nfunction App() {\n    const [imgBuf, setImgBuf] = React.useState<ArrayBuffer>();\n\n    const onClickGenerate = (newImgBuf: ArrayBuffer) => {\n        setImgBuf(newImgBuf);\n    }\n\n    return (<>\n            <DalgonaHeader />\n            <Container maxWidth={\"lg\"} sx={{marginTop: \"15px\"}}>\n                <Grid container spacing={2}>\n                    <Grid item xs={12} md={8}>\n                        <DalgonaCanvas imgBuf={imgBuf} />\n                    </Grid>\n                    <Grid item xs={12} md={4}>\n                        <DalgonaForm onClickGenerate={onClickGenerate} />\n                    </Grid>\n                </Grid>\n            </Container>\n            <DalgonaFooter/>\n        </>\n    );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport { combineReducers } from \"@reduxjs/toolkit\";\nimport dalgonaState from './slices/dalgona-state';\n\nconst reducer = combineReducers({\n    dalgonaState,\n});\n\nexport type ReducerType = ReturnType<typeof reducer>;\nexport default reducer;\n\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport { configureStore } from \"@reduxjs/toolkit\";\nimport reducer from './rootReducer';\nimport logger from 'redux-logger';\n\nconst store = configureStore({\n    reducer,\n    middleware: (getDefaultMiddleware) => getDefaultMiddleware().concat(logger),\n});\n\nexport type AppDispatch = typeof store.dispatch\nexport default store;\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport { Provider } from 'react-redux';\nimport store from './store'\n\nReactDOM.render(\n  <React.StrictMode>\n      <Provider store={store}>\n        <App />\n      </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}