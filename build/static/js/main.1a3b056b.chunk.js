(this["webpackJsonpdalgona-meme"]=this["webpackJsonpdalgona-meme"]||[]).push([[0],{197:function(e,t,n){},198:function(e,t,n){},211:function(e,t){},213:function(e,t){},223:function(e,t){},225:function(e,t){},250:function(e,t){},251:function(e,t){},256:function(e,t){},258:function(e,t){},265:function(e,t){},284:function(e,t){},300:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(31),i=n.n(c),o=(n(197),n(11)),s=(n(198),n(345)),l=n(346),d=n(26),u=n.n(d),h=n(41),j=n(38),b=n(33),g=n(353),f=n(176),x=n.n(f),p=n(340),m=n(348),O=n(343),v=n(347),y=n(349),w=n(342),k=n(47),I=Object(k.b)({name:"dalgona-state",initialState:{scale:1,isLoading:!1,generate:!1},reducers:{changeDalgonaState:function(e,t){return t.payload}}}),S=I.actions.changeDalgonaState,C=I.reducer,R=n(350),L=n(351),D=n(178),F=n.n(D),T=n(177),B=n.n(T),E=n(352),U=function(e){var t=e.action,n=e.category,a=e.label,r=e.value;window.gtag("event",t,{event_category:n,event_label:a,value:r})},G=n(1),P={color:"#ddd"},z=function(e){var t,n=e.onClickGenerate,a=r.a.useState(),c=Object(o.a)(a,2),i=c[0],l=c[1],d=r.a.useState(1),f=Object(o.a)(d,2),k=f[0],I=f[1],C=r.a.useState(""),D=Object(o.a)(C,2),T=D[0],z=D[1],A=r.a.useState(""),M=Object(o.a)(A,2),_=M[0],Y=M[1],W=r.a.useState(!1),X=Object(o.a)(W,2),J=X[0],V=X[1],N=Object(b.c)((function(e){return e.dalgonaState})),q=Object(b.b)();r.a.useEffect((function(){if("number"===typeof k){var e=Object(j.a)({},N);e.scale=k,q(S(e))}}),[k]),r.a.useEffect((function(){var e,t;N.threshold1!==T&&z(null!==(e=null===N||void 0===N||null===(t=N.threshold1)||void 0===t?void 0:t.toFixed(2))&&void 0!==e?e:"")}),[N.threshold1]),r.a.useEffect((function(){var e,t;N.threshold2!==_&&Y(null!==(e=null===N||void 0===N||null===(t=N.threshold2)||void 0===t?void 0:t.toFixed(2))&&void 0!==e?e:"")}),[N.threshold2]),r.a.useEffect((function(){console.log("dalgonaState.isLoading: ".concat(N.isLoading))}),[N.isLoading]);var H=function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==i){e.next=3;break}return alert("\uc0ac\uc6a9\ud560 \uc774\ubbf8\uc9c0\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694."),e.abrupt("return");case 3:return t=Date.now(),e.next=6,i.arrayBuffer();case 6:a=e.sent,n(a),r=Date.now()-t,U({action:"generate",category:"click",label:JSON.stringify({elapsed:r}),value:0}),V(!1);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(e){return function(t,n){"number"===typeof n?e(n):console.error("invalid type of newValue (type: ".concat(typeof n,")"))}},Q=function(e){z(e),V(!0);var t=Object(j.a)({},N);t.threshold1="number"===typeof e?e:void 0,q(S(t))},Z=function(e){Y(e),V(!0);var t=Object(j.a)({},N);t.threshold2="number"===typeof e?e:void 0,q(S(t))};return Object(G.jsxs)("form",{children:[Object(G.jsxs)(v.a,{children:[Object(G.jsx)("input",{type:"file",id:"input-photo",accept:"image/*",onChange:function(e){if(console.log(e.target.value),console.log(e.currentTarget.files),e.currentTarget.files&&e.currentTarget.files.length>0){var t=e.currentTarget.files[0];l(t)}V(!0)},disabled:N.isLoading}),Object(G.jsx)(p.a,{title:"Select image",children:Object(G.jsx)(G.Fragment,{children:Object(G.jsx)("label",{htmlFor:"input-photo",children:Object(G.jsx)(m.a,{color:"primary","aria-label":"upload picture",component:"span",disabled:N.isLoading,children:Object(G.jsx)(x.a,{fontSize:"large"})})})})})]}),Object(G.jsx)(v.a,{children:Object(G.jsxs)(s.a,{container:!0,spacing:2,alignItems:"center",children:[Object(G.jsx)(s.a,{item:!0,xs:6,children:Object(G.jsx)(y.a,{id:"lt-slider",gutterBottom:!0,children:"Threshold 1"})}),Object(G.jsx)(s.a,{item:!0,xs:6,children:Object(G.jsx)(R.a,{children:Object(G.jsx)(L.a,{control:Object(G.jsx)(w.a,{disabled:N.isLoading,checked:void 0===N.threshold1,onChange:function(e){var t=e.target.checked;Q(t?"":.01)},style:P}),label:"auto"})})})]})}),Object(G.jsx)(v.a,{children:Object(G.jsx)(s.a,{container:!0,spacing:2,alignItems:"center",children:Object(G.jsx)(s.a,{item:!0,xs:12,children:Object(G.jsx)(O.a,{track:!1,"aria-labelledby":"lt-slider",valueLabelDisplay:"auto",value:void 0===N.threshold1?0:N.threshold1,onChange:K(Q),step:1,min:0,max:255,disabled:N.isLoading})})})}),Object(G.jsx)(v.a,{children:Object(G.jsxs)(s.a,{container:!0,spacing:2,alignItems:"center",children:[Object(G.jsx)(s.a,{item:!0,xs:6,children:Object(G.jsx)(y.a,{id:"ut-slider",gutterBottom:!0,children:"Threshold 2"})}),Object(G.jsx)(s.a,{item:!0,xs:6,children:Object(G.jsx)(R.a,{children:Object(G.jsx)(L.a,{control:Object(G.jsx)(w.a,{disabled:N.isLoading,checked:void 0===N.threshold2,onChange:function(e){var t=e.target.checked;Z(t?"":.5)},style:P}),label:"auto"})})})]})}),Object(G.jsx)(v.a,{children:Object(G.jsx)(s.a,{container:!0,spacing:2,alignItems:"center",children:Object(G.jsx)(s.a,{item:!0,xs:12,children:Object(G.jsx)(O.a,{track:!1,"aria-labelledby":"ut-slider",valueLabelDisplay:"auto",value:null!==(t=null===N||void 0===N?void 0:N.threshold2)&&void 0!==t?t:0,onChange:K(Z),step:1,min:0,max:255,disabled:N.isLoading})})})}),Object(G.jsxs)(v.a,{children:[Object(G.jsx)(y.a,{id:"scale-slider",gutterBottom:!0,children:"Image scale"}),Object(G.jsx)(s.a,{container:!0,spacing:2,alignItems:"center",children:Object(G.jsx)(s.a,{item:!0,xs:!0,children:Object(G.jsx)(O.a,{track:!1,"aria-labelledby":"scale-slider",valueLabelDisplay:"auto",value:"number"===typeof k?k:1,onChange:K(I),step:.1,min:.1,max:3,disabled:N.isLoading})})})]}),Object(G.jsx)(v.a,{style:{marginTop:"18px"},children:Object(G.jsx)(s.a,{container:!0,spacing:2,alignItems:"center",children:N.isLoading?Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)(s.a,{item:!0,xs:5}),Object(G.jsx)(s.a,{item:!0,xs:2,children:Object(G.jsx)(E.a,{})}),Object(G.jsx)(s.a,{item:!0,xs:5})]}):Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)(s.a,{item:!0,xs:6,children:Object(G.jsx)(g.a,{style:{width:"100%"},variant:J?"contained":"outlined",onClick:H,startIcon:Object(G.jsx)(B.a,{}),children:"Apply"})}),Object(G.jsx)(s.a,{item:!0,xs:6,children:Object(G.jsx)(g.a,{style:{width:"100%"},variant:"outlined",onClick:function(){var e=Object(j.a)({},N);e.generate=!0,q(S(e)),U({action:"download",category:"click",label:"",value:0})},startIcon:Object(G.jsx)(F.a,{}),children:"Generate"})})]})})})]})},A=n(42),M=n.n(A),_=n.p+"static/media/background.d52b6394.png",Y=n.p+"static/media/mask.5c3c32d3.png",W=Object(k.b)({name:"result-image-state",initialState:{dataUrl:void 0},reducers:{changeResultImageState:function(e,t){return t.payload}}}),X=W.actions.changeResultImageState,J=W.reducer,V=function(e){return"data:image/png;base64,".concat(function(e){var t=new Uint8Array(e);return btoa(t.reduce((function(e,t){return e+String.fromCharCode(t)}),""))}(e))},N=function(e){var t=e.imgBuf,n=1543,a=770,c=82,i=48,s=12,l=r.a.useRef(null),d=r.a.useRef(null),g=r.a.useRef(null),f=r.a.useRef(null),x=r.a.useRef(null),p=r.a.useRef(null),m=r.a.useRef(null),O=r.a.useState(!1),v=Object(o.a)(O,2),y=v[0],w=v[1],k=r.a.useState({x:0,y:0}),I=Object(o.a)(k,2),C=I[0],R=I[1],L=r.a.useState({x:818,y:376}),D=Object(o.a)(L,2),F=D[0],T=D[1],B=Object(b.c)((function(e){return e.dalgonaState})),E=Object(b.b)();r.a.useEffect((function(){B.generate&&A()}),[B.generate]),r.a.useEffect((function(){z(F.x,F.y).then()}),[B.scale]);var U=function(){var e=Object(h.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=new Image;a.src=t,a.crossOrigin="Anonymous",a.onload=function(){console.timeEnd("loadImage"),e(a)}})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(h.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof l){e.next=3;break}return console.time("canvasBackgroundRef is undefined"),e.abrupt("return");case 3:if(null!==(t=l.current)){e.next=7;break}return console.log("canvasBackgroundRef.current is null"),e.abrupt("return");case 7:if(null!==(n=t.getContext("2d"))){e.next=10;break}return e.abrupt("return");case 10:return e.t0=n,e.next=13,U(_);case 13:e.t1=e.sent,e.t0.drawImage.call(e.t0,e.t1,0,0),n.save();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=Object(h.a)(u.a.mark((function e(t,n){var a,r,c,i,o,s,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof d&&null!==d){e.next=3;break}return console.time("canvasPictureRef is undefined or null"),e.abrupt("return");case 3:if(null!==x){e.next=6;break}return console.time("imageRef is null"),e.abrupt("return");case 6:if(null!==(a=d.current)){e.next=10;break}return console.log("canvasPictureRef.current is null"),e.abrupt("return");case 10:if(null!==(r=a.getContext("2d"))){e.next=13;break}return e.abrupt("return");case 13:r.clearRect(0,0,a.width,a.height),r.beginPath(),r.drawImage(p.current,0,0),r.save(),r.translate(771.5,385),r.globalCompositeOperation="source-in",c=(-771.5+t)*B.scale,i=(-385+n)*B.scale,console.log("posX: ".concat(c,", posY: ").concat(i)),o=m.current,s=parseInt(o.width+"")*B.scale,l=parseInt(o.height+"")*B.scale,r.drawImage(o,c,i,s,l),r.restore();case 27:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),A=function(){var e=l.current,t=d.current,n=f.current,a=n.getContext("2d");a.drawImage(e,0,0),a.drawImage(t,0,0);var r={dataUrl:n.toDataURL()};E(X(r));var c=Object(j.a)({},B);c.generate=!1,E(S(c))};r.a.useEffect((function(){P().then()}),[l]),r.a.useEffect((function(){if(void 0!==t&&null!==x&&null!==p){W(!0),E(X({dataUrl:void 0}));var e=p.current;e.onload=function(){var e=x.current;e.onload=function(){if(void 0!==t){var n=g.current,a=n.getContext("2d");a.clearRect(0,0,e.width,e.height),n.height=e.height,n.width=e.width,console.log("width: ".concat(n.width)),console.log("height: ".concat(n.height)),a.drawImage(e,0,0,e.width,e.height),a.save(),J(),console.log("onload")}},e.src=V(t)},e.src=Y}}),[t,x,p]);var W=function(e){var t=Object(j.a)({},B);t.isLoading=e,E(S(t))},J=function(){var e,t,n=g.current,a=null!==(e=B.threshold1)&&void 0!==e?e:100,r=null!==(t=B.threshold2)&&void 0!==t?t:100,o=M.a.imread(n),l=new M.a.Mat;M.a.cvtColor(o,l,M.a.COLOR_BGR2GRAY);var d=new M.a.Mat;M.a.Canny(l,d,a,r),M.a.imshow(n,d);var b=n.getContext("2d"),f=b.getImageData(0,0,n.width,n.height);b.clearRect(0,0,n.width,n.height);var x=function(e){for(var t=new Uint8ClampedArray(e),n=0;n<t.length;n+=4){var a=255-t[n],r=255-t[n+1],o=255-t[n+2];255===a&&255===r&&255===o?t[n+3]=0:(a+=c,r+=i,o+=s),t[n]=a,t[n+1]=r,t[n+2]=o}return t}(Array.from(new Uint8Array(f.data.buffer))),p=new ImageData(x,n.width,n.height);b.putImageData(p,0,0),b.shadowBlur=1,b.shadowColor="rgb(".concat(c,", ").concat(i,", ").concat(s,")"),b.drawImage(n,0,0);var O=818-n.width/2,v=376-n.height/2;console.log("relativePosX: ".concat(O,", relativePosY: ").concat(v)),T({x:O,y:v}),R({x:0,y:0});var y=m.current;y.onload=Object(h.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z(O,v);case 2:(t=Object(j.a)({},B)).isLoading=!1,void 0===t.threshold1&&(t.threshold1=a),void 0===t.threshold2&&(t.threshold2=r),E(S(t));case 7:case"end":return e.stop()}}),e)}))),y.src=n.toDataURL()},N=function(){var e=Object(h.a)(u.a.mark((function e(t){var n,a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y){e.next=2;break}return e.abrupt("return");case 2:return n={x:t.pageX,y:t.pageY},a={x:n.x-C.x,y:n.y-C.y},r={x:F.x+a.x,y:F.y+a.y},R(n),T(r),e.next=9,z(r.x,r.y);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(G.jsx)(G.Fragment,{children:Object(G.jsxs)("div",{style:{position:"relative",padding:0,margin:0},children:[Object(G.jsx)("canvas",{ref:l,width:n,height:a,style:{position:"relative",width:"100%",zIndex:1}}),Object(G.jsx)("canvas",{ref:d,width:n,height:a,style:{position:"absolute",width:"100%",zIndex:2,top:0,left:0},onMouseDown:function(e){w(!0);var t={x:e.pageX,y:e.pageY};R(t),console.log("mouse down {x: ".concat(e.pageX,", y: ").concat(e.pageY,"}"))},onMouseUp:function(e){w(!1),console.log("mouse up")},onMouseMove:N}),Object(G.jsx)("canvas",{ref:g,width:n,height:a,style:{visibility:"hidden",width:"100%",zIndex:2,display:"none"}}),Object(G.jsx)("canvas",{ref:f,width:n,height:a,style:{visibility:"hidden",width:"100%",zIndex:2,display:"none"}}),Object(G.jsx)("img",{ref:x,style:{visibility:"hidden",display:"none"},alt:""}),Object(G.jsx)("img",{ref:p,style:{visibility:"hidden",display:"none"},alt:""}),Object(G.jsx)("img",{ref:m,style:{visibility:"hidden",display:"none"},alt:""})]})})},q=n(344),H=n(354),K={backgroundColor:"#d4366e",color:"#222",boxShadow:"none",borderWidth:"0"},Q=function(){return Object(G.jsx)(q.a,{position:"static",style:K,children:Object(G.jsx)(H.a,{children:Object(G.jsxs)(y.a,{variant:"h5",component:"h5",sx:{flexGrow:1,fontWeight:600},children:[Object(G.jsx)("span",{style:{color:"#F5DCB4FF"},children:"Dalgona"})," meme generator"]})})})},Z=n(179),$=n.n(Z),ee=function(){return Object(G.jsx)("div",{children:Object(G.jsx)(l.a,{id:"footer",maxWidth:"lg",sx:{marginTop:"15px"},children:Object(G.jsxs)(s.a,{container:!0,sx:{borderTop:"1px solid #eee",paddingTop:"15px"},children:[Object(G.jsx)(s.a,{item:!0,xs:7,md:9,children:Object(G.jsxs)(y.a,{component:"div",sx:{flexGrow:1},children:["Developed by ",Object(G.jsx)("a",{href:"https://rajephon.dev",target:"_blank",children:"rajephon"})," / ",Object(G.jsxs)("a",{href:"https://github.com/rajephon/dalgona-meme",target:"_blank",children:[Object(G.jsx)($.a,{fontSize:"inherit"})," Github"]}),Object(G.jsx)("br",{}),Object(G.jsx)("a",{href:"https://github.com/rajephon/dalgona-meme/issues",target:"_blank",children:"Report bug & issue"})]})}),Object(G.jsx)(s.a,{item:!0,xs:5,md:3,children:Object(G.jsx)("a",{href:"https://thankyou-for.com/creator/rajephon",target:"_blank",children:Object(G.jsx)("img",{height:"40",style:{border:0,height:"40px"},src:"https://de56jrhz7aye2.cloudfront.net/banner/black.svg",alt:"thank you for button"})})})]})})})},te=function(){var e=r.a.useRef(null);return r.a.useEffect((function(){var t;return null===e||void 0===e||null===(t=e.current)||void 0===t?void 0:t.scrollIntoView()})),Object(G.jsx)("div",{ref:e})},ne=function(){var e=Object(b.c)((function(e){return e.resultImageState}));return Object(G.jsx)(l.a,{maxWidth:"lg",sx:{marginTop:"15px",paddingTop:"15px",borderTop:"1px solid #eee"},children:e.dataUrl&&Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)("img",{src:e.dataUrl,style:{width:"100%"}}),Object(G.jsx)(te,{})]})})};var ae=function(){var e=r.a.useState(),t=Object(o.a)(e,2),n=t[0],a=t[1];return Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)(Q,{}),Object(G.jsx)(l.a,{maxWidth:"lg",sx:{marginTop:"15px"},children:Object(G.jsxs)(s.a,{container:!0,spacing:2,children:[Object(G.jsx)(s.a,{item:!0,xs:12,md:8,children:Object(G.jsx)(N,{imgBuf:n})}),Object(G.jsx)(s.a,{item:!0,xs:12,md:4,children:Object(G.jsx)(z,{onClickGenerate:function(e){a(e)}})}),Object(G.jsx)(s.a,{item:!0,xs:12,md:12,children:Object(G.jsx)(ne,{})})]})}),Object(G.jsx)(ee,{})]})},re=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,355)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))},ce=n(34),ie=Object(ce.b)({dalgonaState:C,resultImageState:J}),oe=n(180),se=n.n(oe),le=Object(k.a)({reducer:ie,middleware:function(e){return e().concat(se.a)}});i.a.render(Object(G.jsx)(r.a.StrictMode,{children:Object(G.jsx)(b.a,{store:le,children:Object(G.jsx)(ae,{})})}),document.getElementById("root")),re()}},[[300,1,2]]]);
//# sourceMappingURL=main.1a3b056b.chunk.js.map