{"version":3,"sources":["slices/dalgona-state.ts","utils/gtag.ts","components/dalgona-form.tsx","images/background.png","images/mask.png","slices/result-image-state.ts","components/dalgona-canvas.tsx","components/dalgona-header.tsx","components/dalgona-footer.tsx","components/dalgona-result.tsx","App.tsx","reportWebVitals.ts","rootReducer.ts","store.ts","index.tsx"],"names":["dalgonaState","createSlice","name","initialState","scale","isLoading","generate","reducers","changeDalgonaState","state","action","payload","actions","event","category","label","value","window","gtag","event_category","event_label","checkboxStyle","color","DalgonaForm","onClickGenerate","React","useState","imgFile","setImgFile","setScale","lt","setLt","ut","setUt","needApply","setNeedApply","useSelector","dispatch","useDispatch","useEffect","newState","threshold1","toFixed","threshold2","console","log","onClickApplyBtn","a","undefined","alert","start","Date","now","arrayBuffer","imgFileBuf","delta","JSON","stringify","elapsed","onChangeSlider","setValueCallback","_","newValue","error","onChangeLowerThreshold","newLt","onChangeUpperThreshold","newUt","Box","type","id","accept","onChange","e","target","currentTarget","files","length","file","disabled","Tooltip","title","htmlFor","IconButton","aria-label","component","fontSize","Grid","container","spacing","alignItems","item","xs","Typography","gutterBottom","FormGroup","FormControlLabel","control","Checkbox","checked","style","Slider","track","aria-labelledby","valueLabelDisplay","step","min","max","marginTop","CircularProgress","Button","width","variant","onClick","startIcon","resultImageState","dataUrl","changeResultImageState","convertToImageDataUrl","imageBuffer","buffer","arr","Uint8Array","btoa","reduce","data","byte","String","fromCharCode","toBase64","DalgonaCanvas","imgBuf","CANVAS_BASE_WIDTH","CANVAS_BASE_HEIGHT","DALGONA_BORDER_COLOR","canvasBackgroundRef","useRef","canvasPictureRef","canvasEdgeRef","canvasDownloadRef","imagePictureRef","imageMaskRef","imageEdgeRef","isDragging","setIsDragging","x","y","mousePos","setMousePos","imageRelativePos","setImageRelativePos","backgroundCanvas","current","pictureCanvas","downloadCanvas","downloadContext","getContext","drawImage","newResultImageState","toDataURL","newDalgonaState","downloadImage","buildPictureCanvasAsync","then","loadImageAsync","imageUrl","Promise","resolve","reject","img","Image","src","crossOrigin","onload","timeEnd","resetBackgroundAsync","time","canvas","ctx","backgroundImg","save","fixedX","fixedY","clearRect","height","beginPath","translate","globalCompositeOperation","posX","posY","edgeImage","imWidth","parseInt","imHeight","restore","onLoading","imageMask","imagePicture","processImage","maskImg","canvasEdge","cv","imread","imgGray","Mat","cvtColor","COLOR_BGR2GRAY","edges","Canny","imshow","imageData","getImageData","pixels","Uint8ClampedArray","i","r","g","b","postprocess","Array","from","newImageData","ImageData","putImageData","shadowBlur","shadowColor","relativePosX","relativePosY","imageEdge","onMouseMove","newMousePos","pageX","pageY","gap","newImageRelativePos","position","padding","margin","ref","zIndex","top","left","onMouseDown","onMouseUp","visibility","display","alt","backgroundColor","boxShadow","borderWidth","DalgonaHeader","AppBar","Toolbar","sx","flexGrow","fontWeight","DalgonaFooter","Container","maxWidth","borderTop","paddingTop","md","href","rel","border","AlwaysScrollToBottom","elementRef","scrollIntoView","DalgonaResult","App","setImgBuf","newImgBuf","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","reducer","combineReducers","store","configureStore","middleware","getDefaultMiddleware","concat","logger","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.fadcd6d2.chunk.js","sourcesContent":["// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\n\nexport interface DalgonaState {\n    scale: number;\n    isLoading: boolean;\n    threshold2?: number;\n    threshold1?: number;\n    generate: boolean;\n}\n\nexport const dalgonaState = createSlice({\n    name: \"dalgona-state\",\n    initialState: {\n        scale: 1.0,\n        isLoading: false,\n        generate: false,\n    } as DalgonaState,\n    reducers: {\n        changeDalgonaState(state, action: PayloadAction<DalgonaState>) {\n            return action.payload;\n        }\n    },\n})\n\nexport const { changeDalgonaState } = dalgonaState.actions;\nexport default dalgonaState.reducer;\n","export const GA_TRACKING_ID = \"G-33NP429JXQ\";\n\n// https://developers.google.com/analytics/devguides/collection/gtagjs/pages\nexport const pageview = (url: URL) => {\n    window.gtag(\"config\", GA_TRACKING_ID, {\n        page_path: url\n    });\n};\n\ntype GTagEvent = {\n    action: string;\n    category: string;\n    label: string;\n    value: number;\n};\n\n// https://developers.google.com/analytics/devguides/collection/gtagjs/events\nexport const event = ({ action, category, label, value }: GTagEvent) => {\n    window.gtag(\"event\", action, {\n        event_category: category,\n        event_label: label,\n        value: value\n    });\n};\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport React, {FunctionComponent} from \"react\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport {ReducerType} from \"../rootReducer\";\nimport Button from \"@mui/material/Button\";\nimport PhotoCamera from \"@mui/icons-material/PhotoCamera\";\nimport Tooltip from \"@mui/material/Tooltip\";\nimport IconButton from \"@mui/material/IconButton\";\nimport Slider from \"@mui/material/Slider\";\nimport Box from \"@mui/material/Box\";\nimport Typography from \"@mui/material/Typography\";\nimport Grid from \"@mui/material/Grid\";\nimport Checkbox from \"@mui/material/Checkbox\";\nimport {DalgonaState, changeDalgonaState} from \"../slices/dalgona-state\";\nimport FormGroup from \"@mui/material/FormGroup\";\nimport FormControlLabel from \"@mui/material/FormControlLabel\";\nimport DownloadIcon from \"@mui/icons-material/Download\";\nimport AutoFixHighIcon from \"@mui/icons-material/AutoFixHigh\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport * as gtag from \"../utils/gtag\";\n\n\ndeclare namespace IDalgonaForm {\n    export interface IProp {\n        onClickGenerate: (imgBuf: ArrayBuffer) => void,\n    }\n}\n\nconst checkboxStyle:React.CSSProperties = {\n    color: \"#ddd\",\n};\n\nconst DalgonaForm: FunctionComponent<IDalgonaForm.IProp> = ({onClickGenerate}) => {\n    const [imgFile, setImgFile] = React.useState<File>();\n    const [scale, setScale] = React.useState<number | string>(1.0);\n    const [lt, setLt] = React.useState<number | string>(\"\");\n    const [ut, setUt] = React.useState<number | string>(\"\");\n    const [needApply, setNeedApply] = React.useState<boolean>(false);\n    const dalgonaState = useSelector<ReducerType, DalgonaState>(state => state.dalgonaState);\n    const dispatch = useDispatch();\n\n    React.useEffect(() => {\n        if (typeof scale === \"number\") {\n            const newState = {...dalgonaState};\n            newState.scale = scale;\n            dispatch(changeDalgonaState(newState));\n        }\n    }, [scale]);\n\n    React.useEffect(() => {\n        if (dalgonaState.threshold1 === lt)\n            return;\n\n        setLt(dalgonaState?.threshold1?.toFixed(2) ?? \"\");\n    }, [dalgonaState.threshold1]);\n\n    React.useEffect(() => {\n        if (dalgonaState.threshold2 === ut)\n            return;\n        setUt(dalgonaState?.threshold2?.toFixed(2) ?? \"\");\n    }, [dalgonaState.threshold2]);\n\n    React.useEffect(() => {\n        console.log(`dalgonaState.isLoading: ${dalgonaState.isLoading}`);\n    }, [dalgonaState.isLoading])\n\n\n    const onClickApplyBtn = async () => {\n        if (imgFile === undefined) {\n            alert(\"사용할 이미지를 선택해주세요.\");\n            return;\n        }\n        const start = Date.now();\n\n        const imgFileBuf = await imgFile.arrayBuffer();\n        onClickGenerate(imgFileBuf);\n        const delta = Date.now() - start;\n        gtag.event({\n            action: \"generate\",\n            category: \"click\",\n            label: JSON.stringify({elapsed: delta}),\n            value: 0\n        });\n\n        setNeedApply(false);\n    }\n\n    const onChangeFileInput = (e: React.ChangeEvent<HTMLInputElement>) => {\n        console.log(e.target.value);\n        console.log(e.currentTarget.files);\n        if (e.currentTarget.files && e.currentTarget.files.length > 0) {\n            const file = e.currentTarget.files[0];\n            setImgFile(file);\n        }\n        setNeedApply(true);\n    }\n\n    const onChangeSlider = (setValueCallback: (value: number) => void) => {\n        return (_: Event, newValue: number | number[]) => {\n            if (typeof newValue === \"number\") {\n                setValueCallback(newValue as number);\n            } else {\n                console.error(`invalid type of newValue (type: ${typeof newValue})`);\n            }\n        }\n    }\n\n    const onChangeInput = (setValueCallback: (value: number | string) => void) => {\n        return (e: React.ChangeEvent<HTMLInputElement>) => {\n            setValueCallback((e.target.value === \"\") ? \"\" : Number(e.target.value));\n        }\n    }\n\n    const onChangeLowerThreshold = (newLt: number | string) => {\n        setLt(newLt);\n        setNeedApply(true);\n\n        const newState: DalgonaState = {...dalgonaState};\n        newState.threshold1 = (typeof newLt === \"number\") ? newLt : undefined;\n        dispatch(changeDalgonaState(newState));\n    }\n\n    const onChangeUpperThreshold = (newUt: number | string) => {\n        setUt(newUt);\n        setNeedApply(true);\n\n        const newState: DalgonaState = {...dalgonaState};\n        newState.threshold2 = (typeof newUt === \"number\") ? newUt : undefined;\n        dispatch(changeDalgonaState(newState));\n    }\n\n    const onChangeLtAutoCheckbox = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const checked = event.target.checked;\n        const newLt = checked ? \"\" : 0.01;\n\n        onChangeLowerThreshold(newLt);\n    }\n\n    const onChangeUtAutoCheckbox = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const checked = event.target.checked;\n        const newUt = checked ? \"\" : 0.5;\n\n        onChangeUpperThreshold(newUt);\n    }\n\n    const onClickGenerateBtn = () => {\n        const newState: DalgonaState = {...dalgonaState};\n        newState.generate = true;\n        dispatch(changeDalgonaState(newState));\n\n        gtag.event({\n            action: \"download\",\n            category: \"click\",\n            label: \"\",\n            value: 0\n        });\n    };\n\n    return (\n        <form>\n            <Box>\n                <input type=\"file\" id=\"input-photo\" accept=\"image/*\" onChange={onChangeFileInput}\n                       disabled={dalgonaState.isLoading}/>\n                <Tooltip title=\"Select image\">\n                    <>\n                        <label htmlFor=\"input-photo\">\n                            <IconButton color=\"primary\" aria-label=\"upload picture\" component=\"span\"\n                                        disabled={dalgonaState.isLoading}>\n                                <PhotoCamera fontSize=\"large\"/>\n                            </IconButton>\n                        </label>\n                    </>\n                </Tooltip>\n            </Box>\n            <Box>\n                <Grid container spacing={2} alignItems=\"center\">\n                    <Grid item xs={6}>\n                        <Typography id=\"lt-slider\" gutterBottom>Threshold 1</Typography>\n                    </Grid>\n                    <Grid item xs={6}>\n                        <FormGroup>\n                            <FormControlLabel control={<Checkbox\n                                disabled={dalgonaState.isLoading}\n                                checked={dalgonaState.threshold1 === undefined}\n                                onChange={onChangeLtAutoCheckbox}\n                                style={checkboxStyle}\n                            />} label={\"auto\"}/>\n                        </FormGroup>\n                    </Grid>\n                </Grid>\n            </Box>\n            <Box>\n                <Grid container spacing={2} alignItems=\"center\">\n                    <Grid item xs={12}>\n                        <Slider track={false}\n                                aria-labelledby=\"lt-slider\"\n                                valueLabelDisplay=\"auto\"\n                                value={dalgonaState.threshold1 === undefined ? 0.0 : dalgonaState.threshold1}\n                                onChange={onChangeSlider(onChangeLowerThreshold)}\n                                step={1}\n                                min={0}\n                                max={255}\n                                disabled={dalgonaState.isLoading}\n                        />\n                    </Grid>\n                </Grid>\n            </Box>\n\n            <Box>\n                <Grid container spacing={2} alignItems=\"center\">\n                    <Grid item xs={6}>\n                        <Typography id=\"ut-slider\" gutterBottom>\n                            Threshold 2\n                        </Typography>\n                    </Grid>\n                    <Grid item xs={6}>\n                        <FormGroup>\n                            <FormControlLabel control={<Checkbox\n                                disabled={dalgonaState.isLoading}\n                                checked={dalgonaState.threshold2 === undefined}\n                                onChange={onChangeUtAutoCheckbox}\n                                style={checkboxStyle}\n                            />} label={\"auto\"}/>\n                        </FormGroup>\n                    </Grid>\n                </Grid>\n            </Box>\n            <Box>\n                <Grid container spacing={2} alignItems=\"center\">\n                    {/*<Grid item xs={1}/>*/}\n                    <Grid item xs={12}>\n                        <Slider track={false}\n                                aria-labelledby=\"ut-slider\"\n                                valueLabelDisplay=\"auto\"\n                                value={dalgonaState?.threshold2 ?? 0.0}\n                                onChange={onChangeSlider(onChangeUpperThreshold)}\n                                step={1}\n                                min={0}\n                                max={255}\n                                disabled={dalgonaState.isLoading}\n                        />\n                    </Grid>\n                </Grid>\n            </Box>\n            <Box>\n                <Typography id=\"scale-slider\" gutterBottom>\n                    Image scale\n                </Typography>\n                <Grid container spacing={2} alignItems=\"center\">\n                    <Grid item xs>\n                        <Slider track={false}\n                                aria-labelledby=\"scale-slider\"\n                                valueLabelDisplay=\"auto\"\n                                value={typeof scale === \"number\" ? scale : 1.0}\n                                onChange={onChangeSlider(setScale)}\n                                step={0.1}\n                                min={0.1}\n                                max={3.0}\n                                disabled={dalgonaState.isLoading}\n                        />\n                    </Grid>\n                </Grid>\n            </Box>\n            <Box style={{marginTop: \"18px\"}}>\n                <Grid container spacing={2} alignItems=\"center\">\n                    {dalgonaState.isLoading ?\n                        <>\n                            <Grid item xs={5}/>\n                            <Grid item xs={2}>\n                                <CircularProgress/>\n                            </Grid>\n                            <Grid item xs={5}/>\n                        </>\n                        :\n                        <>\n                            <Grid item xs={6}>\n                                <Button\n                                    style={{width: \"100%\"}}\n                                    variant={needApply?\"contained\":\"outlined\"}\n                                    onClick={onClickApplyBtn}\n                                    startIcon={<AutoFixHighIcon/>}>\n                                    Apply\n                                </Button>\n                            </Grid>\n                            <Grid item xs={6}>\n                                <Button\n                                    style={{width: \"100%\"}}\n                                    variant=\"outlined\"\n                                    onClick={onClickGenerateBtn}\n                                    startIcon={<DownloadIcon/>}>\n                                    Generate\n                                </Button>\n                            </Grid>\n                        </>\n                    }\n\n                </Grid>\n            </Box>\n        </form>\n    )\n};\n\nexport default DalgonaForm;\n","export default __webpack_public_path__ + \"static/media/background.d52b6394.png\";","export default __webpack_public_path__ + \"static/media/mask.5c3c32d3.png\";","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\n\nexport interface ResultImageState {\n    dataUrl?: string\n}\n\nexport const resultImageState = createSlice({\n    name: \"result-image-state\",\n    initialState: {\n        dataUrl: undefined\n    } as ResultImageState,\n    reducers: {\n        changeResultImageState(state, action: PayloadAction<ResultImageState>) {\n            return action.payload;\n        }\n    },\n})\n\nexport const { changeResultImageState } = resultImageState.actions;\nexport default resultImageState.reducer;\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport React, {FunctionComponent} from \"react\";\nimport {useDispatch, useSelector} from \"react-redux\";\nimport cv from \"@techstark/opencv-js\";\nimport {ReducerType} from \"../rootReducer\";\nimport {DalgonaState, changeDalgonaState} from \"../slices/dalgona-state\";\nimport backgroundImg from \"../images/background.png\";\nimport maskImg from \"../images/mask.png\";\nimport {changeResultImageState, ResultImageState} from \"../slices/result-image-state\";\n\ndeclare namespace IDalgonaCanvas {\n    export interface IProps {\n        imgBuf?: ArrayBuffer,\n    }\n}\n\nconst toBase64 = (buffer: ArrayBuffer) => {\n    const arr = new Uint8Array(buffer)\n    return btoa(\n        arr.reduce((data, byte) => data + String.fromCharCode(byte), '')\n    );\n}\n\nconst convertToImageDataUrl = (imageBuffer: ArrayBuffer) => `data:image/png;base64,${toBase64(imageBuffer)}`\n\nconst DalgonaCanvas: FunctionComponent<IDalgonaCanvas.IProps> = ({imgBuf}) => {\n    const CANVAS_BASE_WIDTH = 1543;\n    const CANVAS_BASE_HEIGHT = 770;\n\n    const BASE_POS_X = 818;\n    const BASE_POS_Y = 376;\n\n    // const border\n    const DALGONA_BORDER_COLOR = {\n        r: 82,\n        g: 48,\n        b: 12\n    }\n\n    const canvasBackgroundRef = React.useRef<HTMLCanvasElement>(null);\n    const canvasPictureRef = React.useRef<HTMLCanvasElement>(null);\n    const canvasEdgeRef = React.useRef<HTMLCanvasElement>(null);\n    const canvasDownloadRef = React.useRef<HTMLCanvasElement>(null);\n\n    const imagePictureRef = React.useRef<HTMLImageElement>(null);\n    const imageMaskRef = React.useRef<HTMLImageElement>(null);\n    const imageEdgeRef = React.useRef<HTMLImageElement>(null);\n\n    const [isDragging, setIsDragging] = React.useState<boolean>(false);\n    const [mousePos, setMousePos] = React.useState<{ x: number, y: number }>({x: 0, y: 0});\n    const [imageRelativePos, setImageRelativePos] = React.useState<{ x: number, y: number }>({\n        x: BASE_POS_X,\n        y: BASE_POS_Y\n    });\n\n    const dalgonaState = useSelector<ReducerType, DalgonaState>(state => state.dalgonaState);\n    const dispatch = useDispatch();\n\n    React.useEffect(() => {\n        const downloadImage = () => {\n            const backgroundCanvas = canvasBackgroundRef.current!;\n            const pictureCanvas = canvasPictureRef.current!;\n\n            const downloadCanvas = canvasDownloadRef.current!;\n            const downloadContext = downloadCanvas.getContext('2d')!;\n\n            downloadContext.drawImage(backgroundCanvas, 0, 0);\n            downloadContext.drawImage(pictureCanvas, 0, 0);\n\n            const newResultImageState:ResultImageState = {\n                dataUrl: downloadCanvas.toDataURL()\n            };\n            dispatch(changeResultImageState(newResultImageState));\n\n            const newDalgonaState:DalgonaState = {...dalgonaState};\n            newDalgonaState.generate = false;\n            dispatch(changeDalgonaState(newDalgonaState));\n        }\n\n        if (dalgonaState.generate) {\n            downloadImage();\n        }\n    }, [dalgonaState.generate, dalgonaState]);\n\n    React.useEffect(() => {\n        buildPictureCanvasAsync(imageRelativePos.x, imageRelativePos.y).then();\n    }, [dalgonaState.scale]);\n\n    const loadImageAsync = async (imageUrl: string): Promise<HTMLImageElement> => {\n        return new Promise(((resolve, reject) => {\n            const img = new Image()\n            img.src = imageUrl\n            img.crossOrigin = 'Anonymous'\n            img.onload = function () {\n                console.timeEnd('loadImage')\n                resolve(img)\n            }\n        }));\n    }\n\n    const resetBackgroundAsync = async () => {\n        if (typeof canvasBackgroundRef === \"undefined\") {\n            console.time(\"canvasBackgroundRef is undefined\");\n            return;\n        }\n        const canvas = canvasBackgroundRef.current;\n        if (canvas === null) {\n            console.log(\"canvasBackgroundRef.current is null\");\n            return;\n        }\n        const ctx = canvas.getContext(\"2d\");\n        if (ctx === null)\n            return;\n        ctx.drawImage(await loadImageAsync(backgroundImg), 0, 0);\n        ctx.save();\n    }\n\n\n    const buildPictureCanvasAsync = async (fixedX: number, fixedY: number) => {\n        if (typeof canvasPictureRef === \"undefined\" || canvasPictureRef === null) {\n            console.time(\"canvasPictureRef is undefined or null\");\n            return;\n        }\n        if (imagePictureRef === null) {\n            console.time(\"imageRef is null\");\n            return;\n        }\n\n        const canvas = canvasPictureRef.current;\n        if (canvas === null) {\n            console.log(\"canvasPictureRef.current is null\");\n            return;\n        }\n\n        const ctx = canvas.getContext(\"2d\");\n        if (ctx === null)\n            return;\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\n        ctx.beginPath();\n\n        // mask for clipping\n        ctx.drawImage(imageMaskRef.current!, 0, 0);\n        ctx.save();\n\n        ctx.translate(CANVAS_BASE_WIDTH / 2, CANVAS_BASE_HEIGHT / 2);\n\n        ctx.globalCompositeOperation = \"source-in\";\n\n        // // calculate position\n        const posX = (-CANVAS_BASE_WIDTH / 2 + fixedX) * dalgonaState.scale;\n        const posY = (-CANVAS_BASE_HEIGHT / 2 + fixedY) * dalgonaState.scale;\n\n        console.log(`posX: ${posX}, posY: ${posY}`);\n\n        const edgeImage = imageEdgeRef.current!;\n        const imWidth = parseInt(edgeImage.width + '') * dalgonaState.scale;\n        const imHeight = parseInt(edgeImage.height + '') * dalgonaState.scale;\n        ctx.drawImage(edgeImage, posX, posY, imWidth, imHeight);\n\n        ctx.restore();\n    }\n\n    React.useEffect(() => {\n        resetBackgroundAsync().then();\n    }, [canvasBackgroundRef]);\n\n    React.useEffect(() => {\n        if (imgBuf === undefined)\n            return;\n        if (imagePictureRef === null)\n            return;\n        if (imageMaskRef === null)\n            return;\n\n        onLoading(true);\n\n        dispatch(changeResultImageState({dataUrl:undefined}));\n\n        const imageMask = imageMaskRef.current!;\n        imageMask.onload = () => {\n            const imagePicture = imagePictureRef.current!;\n            imagePicture.onload = () => {\n                if (imgBuf === undefined)\n                    return;\n\n                const canvas = canvasEdgeRef.current!;\n                const ctx = canvas.getContext('2d')!;\n                ctx.clearRect(0, 0, imagePicture.width, imagePicture.height);\n                canvas.height = imagePicture.height;\n                canvas.width = imagePicture.width;\n                console.log(`width: ${canvas.width}`);\n                console.log(`height: ${canvas.height}`);\n\n                ctx.drawImage(imagePicture, 0, 0, imagePicture.width, imagePicture.height);\n                ctx.save();\n                // const imageData = ctx!.getImageData(0, 0, imagePicture.width, imagePicture.height);\n                // detect(imageData.data as any as Uint8Array, imagePicture.width, imagePicture.height, dalgonaState.threshold1, dalgonaState.threshold2, onDetectCallback);\n                processImage();\n\n                console.log(\"onload\");\n            };\n            imagePicture.src = convertToImageDataUrl(imgBuf);\n\n        }\n        imageMask.src = maskImg;\n    }, [imgBuf, imagePictureRef, imageMaskRef]);\n\n    const onLoading = (isLoading: boolean) => {\n        const newDalgonaState:DalgonaState = {...dalgonaState};\n        newDalgonaState.isLoading = isLoading;\n        dispatch(changeDalgonaState(newDalgonaState));\n    }\n\n    const postprocess = (buffer: number[]): Uint8ClampedArray => {\n        const pixels = new Uint8ClampedArray(buffer);\n\n        // 색상 반전 및\n        for (let i = 0; i < pixels.length; i += 4) {\n            // 색상 뒤짚기\n            let r = 255 - pixels[i];\n            let g = 255 - pixels[i + 1];\n            let b = 255 - pixels[i + 2];\n\n            if (r === 255 && g === 255 && b === 255) {\n                pixels[i + 3] = 0;\n            } else {\n                r += DALGONA_BORDER_COLOR.r;\n                g += DALGONA_BORDER_COLOR.g;\n                b += DALGONA_BORDER_COLOR.b;\n            }\n\n            pixels[i] = r;\n            pixels[i + 1] = g;\n            pixels[i + 2] = b;\n        }\n\n        return pixels;\n    }\n\n    const processImage = () => {\n        const canvasEdge = canvasEdgeRef.current!;\n\n        const threshold1 = dalgonaState.threshold1 ?? 100;\n        const threshold2 = dalgonaState.threshold2 ?? 100;\n\n        const img = cv.imread(canvasEdge);\n\n        // to gray scale\n        const imgGray = new cv.Mat();\n        cv.cvtColor(img, imgGray, cv.COLOR_BGR2GRAY);\n\n        // detect edges using Canny\n        const edges = new cv.Mat();\n        cv.Canny(imgGray, edges, threshold1, threshold2);\n        cv.imshow(canvasEdge, edges);\n\n        const ctx = canvasEdge!.getContext('2d')!;\n        const imageData = ctx.getImageData(0, 0, canvasEdge.width, canvasEdge.height);\n        ctx.clearRect(0, 0, canvasEdge.width, canvasEdge.height)\n\n        const pixels = postprocess(Array.from(new Uint8Array(imageData.data.buffer)));\n\n        const newImageData = new ImageData(pixels, canvasEdge.width, canvasEdge.height);\n        ctx.putImageData(newImageData, 0, 0);\n\n        // 덧칠\n        ctx.shadowBlur = 1;\n        ctx.shadowColor = `rgb(${DALGONA_BORDER_COLOR.r}, ${DALGONA_BORDER_COLOR.g}, ${DALGONA_BORDER_COLOR.b})`;\n        ctx.drawImage(canvasEdge, 0, 0);\n\n        const relativePosX = BASE_POS_X - (canvasEdge.width / 2);\n        const relativePosY = BASE_POS_Y - (canvasEdge.height / 2);\n        console.log(`relativePosX: ${relativePosX}, relativePosY: ${relativePosY}`);\n        setImageRelativePos({x: relativePosX, y: relativePosY});\n        setMousePos({x: 0, y: 0});\n\n\n        const imageEdge = imageEdgeRef.current!;\n        imageEdge.onload = async () => {\n            await buildPictureCanvasAsync(relativePosX, relativePosY);\n\n            const newState:DalgonaState = {...dalgonaState};\n            newState.isLoading = false;\n            if (newState.threshold1 === undefined)\n                newState.threshold1 = threshold1;\n            if (newState.threshold2 === undefined)\n                newState.threshold2 = threshold2;\n\n            dispatch(changeDalgonaState(newState));\n        }\n\n        imageEdge.src = canvasEdge.toDataURL();\n\n    }\n\n    const onMouseMove = async (e: React.MouseEvent<HTMLCanvasElement>) => {\n        if (!isDragging) {\n            return;\n        }\n\n        const newMousePos = {x: e.pageX, y: e.pageY};\n        const gap = {\n            x: newMousePos.x - mousePos.x,\n            y: newMousePos.y - mousePos.y\n        };\n\n        const newImageRelativePos = {\n            x: imageRelativePos.x + gap.x,\n            y: imageRelativePos.y + gap.y\n        }\n\n        setMousePos(newMousePos);\n        setImageRelativePos(newImageRelativePos);\n\n        await buildPictureCanvasAsync(newImageRelativePos.x, newImageRelativePos.y);\n    }\n\n    const onMouseDown = (e: React.MouseEvent<HTMLCanvasElement>) => {\n        setIsDragging(true);\n        const newMousePos = {x: e.pageX, y: e.pageY};\n        setMousePos(newMousePos);\n\n        console.log(`mouse down {x: ${e.pageX}, y: ${e.pageY}}`);\n    }\n    const onMouseUp = (_: React.MouseEvent<HTMLCanvasElement>) => {\n        setIsDragging(false);\n        console.log(\"mouse up\")\n    }\n\n    return (\n        <>\n            <div style={{position: \"relative\", padding: 0, margin: 0}}>\n                <canvas ref={canvasBackgroundRef} width={CANVAS_BASE_WIDTH} height={CANVAS_BASE_HEIGHT}\n                        style={{position: \"relative\", width: \"100%\", zIndex: 1}}/>\n                <canvas ref={canvasPictureRef} width={CANVAS_BASE_WIDTH} height={CANVAS_BASE_HEIGHT}\n                        style={{position: \"absolute\", width: \"100%\", zIndex: 2, top: 0, left: 0}}\n                        onMouseDown={onMouseDown} onMouseUp={onMouseUp} onMouseMove={onMouseMove}/>\n                <canvas ref={canvasEdgeRef} width={CANVAS_BASE_WIDTH} height={CANVAS_BASE_HEIGHT}\n                        style={{visibility: \"hidden\", width: \"100%\", zIndex: 2, display: \"none\"}}/>\n                <canvas ref={canvasDownloadRef} width={CANVAS_BASE_WIDTH} height={CANVAS_BASE_HEIGHT}\n                        style={{visibility: \"hidden\", width: \"100%\", zIndex: 2, display: \"none\"}}/>\n                <img ref={imagePictureRef} style={{visibility: \"hidden\", display: \"none\"}} alt=\"\"/>\n                <img ref={imageMaskRef} style={{visibility: \"hidden\", display: \"none\"}} alt=\"\"/>\n                <img ref={imageEdgeRef} style={{visibility: \"hidden\", display: \"none\"}} alt=\"\"/>\n            </div>\n        </>\n    );\n}\n\nexport default DalgonaCanvas;\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport React from \"react\";\nimport Typography from \"@mui/material/Typography\";\nimport AppBar from \"@mui/material/AppBar\";\nimport Toolbar from '@mui/material/Toolbar';\n\nconst style: React.CSSProperties = {\n    backgroundColor: \"#d4366e\",\n    color: \"#222\",\n    boxShadow: \"none\",\n    borderWidth: \"0\",\n};\n\nconst DalgonaHeader = () => {\n    return <AppBar position={\"static\"} style={style}>\n        <Toolbar>\n            <Typography variant=\"h5\" component=\"h5\" sx={{flexGrow: 1, fontWeight: 600}}>\n                <span style={{color: \"#F5DCB4FF\"}}>Dalgona</span> meme generator\n            </Typography>\n        </Toolbar>\n    </AppBar>;\n}\n\nexport default DalgonaHeader;\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport React from \"react\";\nimport Container from \"@mui/material/Container\";\nimport Typography from \"@mui/material/Typography\";\nimport GitHubIcon from '@mui/icons-material/GitHub';\nimport Grid from \"@mui/material/Grid\";\n\n\nconst DalgonaFooter = () => {\n    // return <Container id=\"footer\" maxWidth={\"lg\"} sx={{marginTop: \"15px\", paddingTop: \"15px\", borderTop:\"1px solid #eee\"}}>\n\n    // </Container>;\n    return <div>\n        <Container id=\"footer\" maxWidth={\"lg\"}\n                   sx={{marginTop: \"15px\"}}>\n            <Grid container sx={{borderTop: \"1px solid #eee\", paddingTop: \"15px\"}}>\n                <Grid item xs={7} md={9}>\n                    <Typography component=\"div\" sx={{flexGrow: 1}}>\n                        Developed by <a href=\"https://rajephon.dev\" target=\"_blank\" rel=\"noreferrer\">rajephon</a> / <a\n                        href=\"https://github.com/rajephon/dalgona-meme\" target=\"_blank\" rel=\"noreferrer\"><GitHubIcon\n                        fontSize=\"inherit\"/> Github</a><br/>\n                        <a href=\"https://github.com/rajephon/dalgona-meme/issues\" target=\"_blank\" rel=\"noreferrer\">Report\n                            bug &amp; issue</a>\n                    </Typography>\n                </Grid>\n                <Grid item xs={5} md={3}>\n                    <a href=\"https://thankyou-for.com/creator/rajephon\" target=\"_blank\" rel=\"noreferrer\">\n                        <img height=\"40\" style={{border: 0, height: \"40px\"}}\n                             src=\"https://de56jrhz7aye2.cloudfront.net/banner/black.svg\" alt=\"thank you for button\"/>\n                    </a>\n                </Grid>\n            </Grid>\n        </Container>\n    </div>\n}\n\nexport default DalgonaFooter;\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport React from \"react\";\nimport Container from \"@mui/material/Container\";\nimport {useSelector} from \"react-redux\";\nimport {ReducerType} from \"../rootReducer\";\nimport {ResultImageState} from \"../slices/result-image-state\";\n\nconst AlwaysScrollToBottom = () => {\n    const elementRef = React.useRef<HTMLDivElement>(null);\n    React.useEffect(() => elementRef?.current?.scrollIntoView());\n    return <div ref={elementRef} />;\n};\n\nconst DalgonaResult = () => {\n    const resultImageState = useSelector<ReducerType, ResultImageState>(state => state.resultImageState);\n\n    return <Container maxWidth={\"lg\"} sx={{marginTop: \"15px\", paddingTop: \"15px\", borderTop:\"1px solid #eee\"}}>\n        {resultImageState.dataUrl && <>\n            <img src={resultImageState.dataUrl} style={{width: \"100%\"}} />\n            <AlwaysScrollToBottom/>\n        </>}\n    </Container>\n}\n\nexport default DalgonaResult;\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport React from 'react';\nimport './App.css';\nimport Grid from \"@mui/material/Grid\";\nimport Container from \"@mui/material/Container\";\nimport DalgonaForm from \"./components/dalgona-form\";\nimport DalgonaCanvas from \"./components/dalgona-canvas\";\nimport DalgonaHeader from \"./components/dalgona-header\";\nimport DalgonaFooter from \"./components/dalgona-footer\";\nimport DalgonaResult from \"./components/dalgona-result\";\n\nfunction App() {\n    const [imgBuf, setImgBuf] = React.useState<ArrayBuffer>();\n\n    const onClickGenerate = (newImgBuf: ArrayBuffer) => {\n        setImgBuf(newImgBuf);\n    }\n\n    return (<>\n            <DalgonaHeader />\n            <Container maxWidth={\"lg\"} sx={{marginTop: \"15px\"}}>\n                <Grid container spacing={2}>\n                    <Grid item xs={12} md={8}>\n                        <DalgonaCanvas imgBuf={imgBuf} />\n                    </Grid>\n                    <Grid item xs={12} md={4}>\n                        <DalgonaForm onClickGenerate={onClickGenerate} />\n                    </Grid>\n                    <Grid item xs={12} md={12}>\n                        <DalgonaResult />\n                    </Grid>\n                </Grid>\n            </Container>\n            <DalgonaFooter/>\n        </>\n    );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport { combineReducers } from \"@reduxjs/toolkit\";\nimport dalgonaState from './slices/dalgona-state';\nimport resultImageState from \"./slices/result-image-state\";\n\nconst reducer = combineReducers({\n    dalgonaState, resultImageState\n});\n\nexport type ReducerType = ReturnType<typeof reducer>;\nexport default reducer;\n\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport { configureStore } from \"@reduxjs/toolkit\";\nimport reducer from './rootReducer';\nimport logger from 'redux-logger';\n\nconst store = configureStore({\n    reducer,\n    middleware: (getDefaultMiddleware) => getDefaultMiddleware().concat(logger),\n});\n\nexport type AppDispatch = typeof store.dispatch\nexport default store;\n","// Copyright (c) 2021. Chanwoo Noh <rajephon@gmail.com>. All rights reserved.\n// Licensed under the MIT license. See LICENSE file in the project root for details.\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport { Provider } from 'react-redux';\nimport store from './store'\n\nReactDOM.render(\n  <React.StrictMode>\n      <Provider store={store}>\n        <App />\n      </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}