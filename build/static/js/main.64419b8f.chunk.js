(this["webpackJsonpdalgona-meme"]=this["webpackJsonpdalgona-meme"]||[]).push([[0],{202:function(e,t,n){},203:function(e,t,n){},216:function(e,t){},218:function(e,t){},228:function(e,t){},230:function(e,t){},255:function(e,t){},256:function(e,t){},261:function(e,t){},263:function(e,t){},270:function(e,t){},289:function(e,t){},305:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(31),c=n.n(i),o=(n(202),n(11)),s=(n(203),n(356)),l=n(357),d=n(24),u=n.n(d),h=n(39),b=n(40),j=n(44),g=n(364),f=n(180),x=n.n(f),p=n(350),m=n(358),v=n(354),O=n(359),y=n(360),w=n(352),k=n(353),C=n(69),I=Object(C.b)({name:"dalgona-state",initialState:{scale:1,isLoading:!1,download:!1},reducers:{changeDalgonaState:function(e,t){return t.payload}}}),L=I.actions.changeDalgonaState,S=I.reducer,R=n(361),D=n(362),T=n(182),B=n.n(T),F=n(181),E=n.n(F),P=n(363),z=function(e){var t=e.action,n=e.category,a=e.label,r=e.value;window.gtag("event",t,{event_category:n,event_label:a,value:r})},G=n(2),A=function(e){var t,n=e.onClickGenerate,a=r.a.useState(),i=Object(o.a)(a,2),c=i[0],l=i[1],d=r.a.useState(1),f=Object(o.a)(d,2),C=f[0],I=f[1],S=r.a.useState(""),T=Object(o.a)(S,2),F=T[0],A=T[1],M=r.a.useState(""),U=Object(o.a)(M,2),Y=U[0],_=U[1],X=Object(j.c)((function(e){return e.dalgonaState})),J=Object(j.b)();r.a.useEffect((function(){if("number"===typeof C){var e=Object(b.a)({},X);e.scale=C,J(L(e))}}),[C]),r.a.useEffect((function(){var e,t;X.threshold1!==F&&A(null!==(e=null===X||void 0===X||null===(t=X.threshold1)||void 0===t?void 0:t.toFixed(2))&&void 0!==e?e:"")}),[X.threshold1]),r.a.useEffect((function(){var e,t;X.threshold2!==Y&&_(null!==(e=null===X||void 0===X||null===(t=X.threshold2)||void 0===t?void 0:t.toFixed(2))&&void 0!==e?e:"")}),[X.threshold2]),r.a.useEffect((function(){console.log("dalgonaState.isLoading: ".concat(X.isLoading))}),[X.isLoading]);var N=function(){var e=Object(h.a)(u.a.mark((function e(){var t,a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==c){e.next=3;break}return alert("\uc0ac\uc6a9\ud560 \uc774\ubbf8\uc9c0\ub97c \uc120\ud0dd\ud574\uc8fc\uc138\uc694."),e.abrupt("return");case 3:return t=Date.now(),e.next=6,c.arrayBuffer();case 6:a=e.sent,n(a),r=Date.now()-t,z({action:"generate",category:"click",label:JSON.stringify({elapsed:r}),value:0});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(e){return function(t,n){"number"===typeof n?e(n):console.error("invalid type of newValue (type: ".concat(typeof n,")"))}},V=function(e){return function(t){e(""===t.target.value?"":Number(t.target.value))}},q=function(e){A(e);var t=Object(b.a)({},X);t.threshold1="number"===typeof e?e:void 0,J(L(t))},H=function(e){_(e);var t=Object(b.a)({},X);t.threshold2="number"===typeof e?e:void 0,J(L(t))};return Object(G.jsxs)("form",{children:[Object(G.jsx)("input",{type:"file",id:"input-photo",accept:"image/*",onChange:function(e){if(console.log(e.target.value),console.log(e.currentTarget.files),e.currentTarget.files&&e.currentTarget.files.length>0){var t=e.currentTarget.files[0];l(t)}},disabled:X.isLoading}),Object(G.jsx)(p.a,{title:"Select image",children:Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)("label",{htmlFor:"input-photo",children:Object(G.jsx)(m.a,{color:"primary","aria-label":"upload picture",component:"span",disabled:X.isLoading,children:Object(G.jsx)(x.a,{fontSize:"large"})})}),Object(G.jsx)(O.a,{children:Object(G.jsxs)(s.a,{container:!0,spacing:2,alignItems:"center",children:[Object(G.jsx)(s.a,{item:!0,xs:6,children:Object(G.jsx)(y.a,{id:"lt-slider",gutterBottom:!0,children:"Threshold 1"})}),Object(G.jsx)(s.a,{item:!0,xs:6,children:Object(G.jsx)(R.a,{children:Object(G.jsx)(D.a,{control:Object(G.jsx)(k.a,{disabled:X.isLoading,checked:void 0===X.threshold1,onChange:function(e){var t=e.target.checked;q(t?"":.01)}}),label:"auto"})})})]})}),Object(G.jsx)(O.a,{children:Object(G.jsxs)(s.a,{container:!0,spacing:2,alignItems:"center",children:[Object(G.jsx)(s.a,{item:!0,xs:10,children:Object(G.jsx)(v.a,{track:!1,"aria-labelledby":"lt-slider",valueLabelDisplay:"auto",value:void 0===X.threshold1?0:X.threshold1,onChange:W(q),step:1,min:0,max:255,disabled:X.isLoading})}),Object(G.jsx)(s.a,{item:!0,xs:!0,children:Object(G.jsx)(w.a,{value:F,size:"small",inputProps:{min:0,max:255,step:1,type:"number","aria-labelledby":"threshold1-slider"},onChange:V(q),disabled:X.isLoading})})]})}),Object(G.jsx)(O.a,{children:Object(G.jsxs)(s.a,{container:!0,spacing:2,alignItems:"center",children:[Object(G.jsx)(s.a,{item:!0,xs:6,children:Object(G.jsx)(y.a,{id:"ut-slider",gutterBottom:!0,children:"Threshold 2"})}),Object(G.jsx)(s.a,{item:!0,xs:6,children:Object(G.jsx)(R.a,{children:Object(G.jsx)(D.a,{control:Object(G.jsx)(k.a,{disabled:X.isLoading,checked:void 0===X.threshold2,onChange:function(e){var t=e.target.checked;H(t?"":.5)}}),label:"auto"})})})]})}),Object(G.jsx)(O.a,{children:Object(G.jsxs)(s.a,{container:!0,spacing:2,alignItems:"center",children:[Object(G.jsx)(s.a,{item:!0,xs:10,children:Object(G.jsx)(v.a,{track:!1,"aria-labelledby":"ut-slider",valueLabelDisplay:"auto",value:null!==(t=null===X||void 0===X?void 0:X.threshold2)&&void 0!==t?t:0,onChange:W(H),step:1,min:0,max:255,disabled:X.isLoading})}),Object(G.jsx)(s.a,{item:!0,xs:!0,children:Object(G.jsx)(w.a,{value:Y,size:"small",inputProps:{min:0,max:255,step:1,type:"number","aria-labelledby":"threshold2-slider"},onChange:V(H),disabled:X.isLoading})})]})}),Object(G.jsxs)(O.a,{children:[Object(G.jsx)(y.a,{id:"scale-slider",gutterBottom:!0,children:"Image scale"}),Object(G.jsxs)(s.a,{container:!0,spacing:2,alignItems:"center",children:[Object(G.jsx)(s.a,{item:!0,xs:10,children:Object(G.jsx)(v.a,{track:!1,"aria-labelledby":"scale-slider",valueLabelDisplay:"auto",value:"number"===typeof C?C:1,onChange:W(I),step:.1,min:.1,max:2,disabled:X.isLoading})}),Object(G.jsx)(s.a,{item:!0,xs:!0,children:Object(G.jsx)(w.a,{value:C,size:"small",inputProps:{min:.1,max:2,step:.1,type:"number","aria-labelledby":"scale-slider"},onChange:V(I),disabled:X.isLoading})})]})]}),Object(G.jsx)(O.a,{style:{marginTop:"18px"},children:Object(G.jsx)(s.a,{container:!0,spacing:2,alignItems:"center",children:X.isLoading?Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)(s.a,{item:!0,xs:5}),Object(G.jsx)(s.a,{item:!0,xs:2,children:Object(G.jsx)(P.a,{})}),Object(G.jsx)(s.a,{item:!0,xs:5})]}):Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)(s.a,{item:!0,xs:6,children:Object(G.jsx)(g.a,{variant:"outlined",onClick:N,startIcon:Object(G.jsx)(E.a,{}),children:"Generate"})}),Object(G.jsx)(s.a,{item:!0,xs:6,children:Object(G.jsx)(g.a,{variant:"outlined",onClick:function(){var e=Object(b.a)({},X);e.download=!0,J(L(e)),z({action:"download",category:"click",label:"",value:0})},startIcon:Object(G.jsx)(B.a,{}),children:"Download"})})]})})})]})})]})},M=n(46),U=n.n(M),Y=n.p+"static/media/background.d52b6394.png",_=n.p+"static/media/mask.5c3c32d3.png",X=function(e){return"data:image/png;base64,".concat(function(e){var t=new Uint8Array(e);return btoa(t.reduce((function(e,t){return e+String.fromCharCode(t)}),""))}(e))},J=function(e){var t=e.imgBuf,n=1543,a=770,i=82,c=48,s=12,l=r.a.useRef(null),d=r.a.useRef(null),g=r.a.useRef(null),f=r.a.useRef(null),x=r.a.useRef(null),p=r.a.useRef(null),m=r.a.useRef(null),v=r.a.useState(!1),O=Object(o.a)(v,2),y=O[0],w=O[1],k=r.a.useState({x:0,y:0}),C=Object(o.a)(k,2),I=C[0],S=C[1],R=r.a.useState({x:818,y:376}),D=Object(o.a)(R,2),T=D[0],B=D[1],F=Object(j.c)((function(e){return e.dalgonaState})),E=Object(j.b)();r.a.useEffect((function(){if(F.download){M();var e=Object(b.a)({},F);e.download=!1,E(L(e))}}),[F.download]),r.a.useEffect((function(){A(T.x,T.y).then()}),[F.scale]);var P=function(){var e=Object(h.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=new Image;a.src=t,a.crossOrigin="Anonymous",a.onload=function(){console.timeEnd("loadImage"),e(a)}})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=Object(h.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof l){e.next=3;break}return console.time("canvasBackgroundRef is undefined"),e.abrupt("return");case 3:if(null!==(t=l.current)){e.next=7;break}return console.log("canvasBackgroundRef.current is null"),e.abrupt("return");case 7:if(null!==(n=t.getContext("2d"))){e.next=10;break}return e.abrupt("return");case 10:return e.t0=n,e.next=13,P(Y);case 13:e.t1=e.sent,e.t0.drawImage.call(e.t0,e.t1,0,0),n.save();case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(h.a)(u.a.mark((function e(t,n){var a,r,i,c,o,s,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof d&&null!==d){e.next=3;break}return console.time("canvasPictureRef is undefined or null"),e.abrupt("return");case 3:if(null!==x){e.next=6;break}return console.time("imageRef is null"),e.abrupt("return");case 6:if(null!==(a=d.current)){e.next=10;break}return console.log("canvasPictureRef.current is null"),e.abrupt("return");case 10:if(null!==(r=a.getContext("2d"))){e.next=13;break}return e.abrupt("return");case 13:r.clearRect(0,0,a.width,a.height),r.beginPath(),r.drawImage(p.current,0,0),r.save(),r.translate(771.5,385),r.globalCompositeOperation="source-in",i=(-771.5+t)*F.scale,c=(-385+n)*F.scale,console.log("posX: ".concat(i,", posY: ").concat(c)),o=m.current,s=parseInt(o.width+"")*F.scale,l=parseInt(o.height+"")*F.scale,r.drawImage(o,i,c,s,l),r.restore();case 27:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),M=function(){var e,t=l.current,n=d.current,a=f.current,r=a.getContext("2d");r.drawImage(t,0,0),r.drawImage(n,0,0);var i=a.toDataURL().replace("image/png","image/octet-stream"),c=document.createElement("a");c.href=i,c.setAttribute("download","dalgona.png"),document.body.appendChild(c),c.click(),null===(e=c.parentNode)||void 0===e||e.removeChild(c)};r.a.useEffect((function(){z().then()}),[l]),r.a.useEffect((function(){if(void 0!==t&&null!==x&&null!==p){J(!0);var e=p.current;e.onload=function(){var e=x.current;e.onload=function(){if(void 0!==t){var n=g.current,a=n.getContext("2d");a.clearRect(0,0,e.width,e.height),n.height=e.height,n.width=e.width,console.log("width: ".concat(n.width)),console.log("height: ".concat(n.height)),a.drawImage(e,0,0,e.width,e.height),a.save(),W(),console.log("onload")}},e.src=X(t)},e.src=_}}),[t,x,p]);var J=function(e){var t=Object(b.a)({},F);t.isLoading=e,E(L(t))},N=function(e){for(var t=new Uint8ClampedArray(e),n=0;n<t.length;n+=4){var a=255-t[n],r=255-t[n+1],o=255-t[n+2];255===a&&255===r&&255===o?t[n+3]=0:(a+=i,r+=c,o+=s),t[n]=a,t[n+1]=r,t[n+2]=o}return t},W=function(){var e=Object(h.a)(u.a.mark((function e(){var t,n,a,r,o,l,d,j,f,x,p,v,O,y,w;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=g.current,r=null!==(t=F.threshold1)&&void 0!==t?t:100,o=null!==(n=F.threshold2)&&void 0!==n?n:100,l=U.a.imread(a),d=new U.a.Mat,U.a.cvtColor(l,d,U.a.COLOR_BGR2GRAY),j=new U.a.Mat,U.a.Canny(d,j,r,o),U.a.imshow(a,j),f=a.getContext("2d"),x=f.getImageData(0,0,a.width,a.height),f.clearRect(0,0,a.width,a.height),p=N(Array.from(new Uint8Array(x.data.buffer))),v=new ImageData(p,a.width,a.height),f.putImageData(v,0,0),f.shadowBlur=1,f.shadowColor="rgb(".concat(i,", ").concat(c,", ").concat(s,")"),f.drawImage(a,0,0),O=818-a.width/2,y=376-a.height/2,console.log("relativePosX: ".concat(O,", relativePosY: ").concat(y)),B({x:O,y:y}),S({x:0,y:0}),(w=m.current).onload=Object(h.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(O,y);case 2:(t=Object(b.a)({},F)).isLoading=!1,void 0===t.threshold1&&(t.threshold1=r),void 0===t.threshold2&&(t.threshold2=o),E(L(t));case 7:case"end":return e.stop()}}),e)}))),w.src=a.toDataURL();case 26:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=Object(h.a)(u.a.mark((function e(t){var n,a,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y){e.next=2;break}return e.abrupt("return");case 2:return n={x:t.pageX,y:t.pageY},a={x:n.x-I.x,y:n.y-I.y},r={x:T.x+a.x,y:T.y+a.y},S(n),B(r),e.next=9,A(r.x,r.y);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(G.jsx)(G.Fragment,{children:Object(G.jsxs)("div",{style:{position:"relative",padding:0,margin:0},children:[Object(G.jsx)("canvas",{ref:l,width:n,height:a,style:{position:"relative",width:"100%",zIndex:1}}),Object(G.jsx)("canvas",{ref:d,width:n,height:a,style:{position:"absolute",width:"100%",zIndex:2,top:0,left:0},onMouseDown:function(e){w(!0);var t={x:e.pageX,y:e.pageY};S(t),console.log("mouse down {x: ".concat(e.pageX,", y: ").concat(e.pageY,"}"))},onMouseUp:function(e){w(!1),console.log("mouse up")},onMouseMove:V}),Object(G.jsx)("canvas",{ref:g,width:n,height:a,style:{visibility:"hidden",width:"100%",zIndex:2,display:"none"}}),Object(G.jsx)("canvas",{ref:f,width:n,height:a,style:{visibility:"hidden",width:"100%",zIndex:2,display:"none"}}),Object(G.jsx)("img",{ref:x,style:{visibility:"hidden",display:"none"},alt:""}),Object(G.jsx)("img",{ref:p,style:{visibility:"hidden",display:"none"},alt:""}),Object(G.jsx)("img",{ref:m,style:{visibility:"hidden",display:"none"},alt:""})]})})},N=n(355),W=n(365),V=function(){return Object(G.jsx)(N.a,{position:"static",children:Object(G.jsx)(W.a,{children:Object(G.jsx)(y.a,{variant:"h6",component:"div",sx:{flexGrow:1},children:"Dalgona meme generator"})})})},q=n(183),H=n.n(q),K=function(){return Object(G.jsx)(l.a,{id:"footer",maxWidth:"lg",sx:{marginTop:"15px",paddingTop:"15px",borderTop:"1px solid #eee"},children:Object(G.jsxs)(y.a,{component:"div",sx:{flexGrow:1},children:["Developed by ",Object(G.jsx)("a",{href:"https://rajephon.dev",target:"_blank",children:"rajephon"})," / ",Object(G.jsxs)("a",{href:"https://github.com/rajephon/dalgona-meme",target:"_blank",children:[Object(G.jsx)(H.a,{fontSize:"inherit"})," Github"]}),Object(G.jsx)("br",{}),Object(G.jsx)("a",{href:"https://github.com/rajephon/dalgona-meme/issues",target:"_blank",children:"Report bug & issue"})]})})};var Q=function(){var e=r.a.useState(),t=Object(o.a)(e,2),n=t[0],a=t[1];return Object(G.jsxs)(G.Fragment,{children:[Object(G.jsx)(V,{}),Object(G.jsx)(l.a,{maxWidth:"lg",sx:{marginTop:"15px"},children:Object(G.jsxs)(s.a,{container:!0,spacing:2,children:[Object(G.jsx)(s.a,{item:!0,xs:12,md:8,children:Object(G.jsx)(J,{imgBuf:n})}),Object(G.jsx)(s.a,{item:!0,xs:12,md:4,children:Object(G.jsx)(A,{onClickGenerate:function(e){a(e)}})})]})}),Object(G.jsx)(K,{})]})},Z=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,366)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,c=t.getTTFB;n(e),a(e),r(e),i(e),c(e)}))},$=n(33),ee=Object($.b)({dalgonaState:S}),te=n(184),ne=n.n(te),ae=Object(C.a)({reducer:ee,middleware:function(e){return e().concat(ne.a)}});c.a.render(Object(G.jsx)(r.a.StrictMode,{children:Object(G.jsx)(j.a,{store:ae,children:Object(G.jsx)(Q,{})})}),document.getElementById("root")),Z()}},[[305,1,2]]]);
//# sourceMappingURL=main.64419b8f.chunk.js.map